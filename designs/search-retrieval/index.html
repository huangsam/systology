<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Search & Retrieval Engine - Systology</title><meta name=description content="High-performance document search."><link rel=canonical href=https://sambyte.net/systology/designs/search-retrieval/><link rel=icon href=/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}</script><link rel=stylesheet href="/css/styles.css?v=1772222251"><link rel=stylesheet href="/css/syntax.css?v=1772222251"><link rel=stylesheet href="/css/search.css?v=1772222251"></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/ aria-label=Systology><img src=/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Search & Retrieval Engine</h1></div><h2>High-performance document search.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/tags/algorithms/>algorithms</a>
<a class=badge href=/tags/monitoring/>monitoring</a>
<a class=badge href=/tags/privacy/>privacy</a>
<a class=badge href=/tags/retrieval/>retrieval</a></div></header><section><h2 id=problem-statement--constraints>Problem Statement & Constraints</h2><p>Design a high-performance search and retrieval engine to index and query large volumes of documents or media, providing fast and relevant results. The system must handle massive query loads, ensure eventual consistency for updates, and maintain sub-millisecond response times while supporting advanced ranking and filtering features.</p><h3 id=functional-requirements>Functional Requirements</h3><ul><li>Index and search large document/media collections.</li><li>Support full-text search, filtering, and faceting.</li><li>Provide relevance ranking and result explanations.</li><li>Handle real-time index updates.</li></ul><h3 id=non-functional-requirements>Non-Functional Requirements</h3><ul><li><strong>Scale:</strong> 1M queries/sec; index 1B+ documents.</li><li><strong>Availability:</strong> 99.99% query availability.</li><li><strong>Consistency:</strong> Eventual consistency for index updates (1‚Äì5 second delay).</li><li><strong>Latency:</strong> P99 &lt; 50ms for query response.</li><li><strong>Workload Profile:</strong><ul><li>Read:Write ratio: ~99:1</li><li>Peak throughput: 1M queries/sec</li><li>Retention: indefinite search index; document versioning</li></ul></li></ul><h2 id=high-level-architecture>High-Level Architecture</h2><div class=mermaid>graph TD
Query["Query Input"] --> QP["Query Parser"]
QP --> Scatter["Scatter (Parallel)"]
Scatter --> Shard1["Shard 1 (Local RankK)"]
Scatter --> Shard2["Shard 2 (Local RankK)"]
Scatter --> ShardN["Shard N (Local RankK)"]
Shard1 --> Gather["Gather & Merge"]
Shard2 --> Gather
ShardN --> Gather
Gather --> Ranker["Re-Ranker"]
Ranker --> Results["Top-K Results"]
Indexer["Index Writer"] -.->|updates| Shard1
Indexer -.->|updates| Shard2
Indexer -.->|updates| ShardN</div><p>A Query Parser scatters inputs across multiple shards. Each shard executes parallel Local Rank-K retrievals combining lexical and semantic signals. A Scatter-Gather coordinator merges shard results, passing candidates through an ML Re-Ranker to optimize the final Top-K absolute order. An independent Index Writer continuously streams updates into shards.</p><h2 id=data-design>Data Design</h2><p>An Inverted Index combines an in-memory dictionary with compressed on-disk posting lists for rapid keyword search. A Vector Store leverages HNSW proximity graphs for dense semantic search alongside JSON metadata for exact faceting.</p><h3 id=inverted-index-sstablessegments>Inverted Index (SSTables/Segments)</h3><table><thead><tr><th style=text-align:left>Component</th><th style=text-align:left>Structure</th><th style=text-align:left>Description</th><th style=text-align:left>Storage</th></tr></thead><tbody><tr><td style=text-align:left><strong>Dictionary</strong></td><td style=text-align:left>Sorted Term Map</td><td style=text-align:left>Term string to Offset lookup.</td><td style=text-align:left>Memory/Cache</td></tr><tr><td style=text-align:left><strong>Postings</strong></td><td style=text-align:left>PForDelta List</td><td style=text-align:left>Compressed document IDs + counts.</td><td style=text-align:left>Disk</td></tr><tr><td style=text-align:left><strong>Positions</strong></td><td style=text-align:left>Delta-coded</td><td style=text-align:left>Token offsets for phrase queries.</td><td style=text-align:left>Disk</td></tr></tbody></table><h3 id=vector-store-hnswivf>Vector Store (HNSW/IVF)</h3><table><thead><tr><th style=text-align:left>Field</th><th style=text-align:left>Type</th><th style=text-align:left>Dim</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left><strong>doc_embedding</strong></td><td style=text-align:left>Float16 Vector</td><td style=text-align:left>768</td><td style=text-align:left>Semantic similarity search.</td></tr><tr><td style=text-align:left><strong>hnsw_graph</strong></td><td style=text-align:left>Proximity Graph</td><td style=text-align:left>N/A</td><td style=text-align:left>Fast approximate NN search.</td></tr><tr><td style=text-align:left><strong>doc_metadata</strong></td><td style=text-align:left>JSON</td><td style=text-align:left>N/A</td><td style=text-align:left>Filtering/Faceting after retrieval.</td></tr></tbody></table><h2 id=deep-dive--trade-offs>Deep Dive & Trade-offs</h2><div class=pseudocode-container><button class=pseudocode-toggle aria-expanded=false aria-controls=inverted-index>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
View Pseudocode: Inverted Index 'AND' Query Intersection</button><div id=inverted-index class=pseudocode-modal aria-hidden=true role=dialog aria-labelledby=modalTitle-inverted-index><div class=pseudocode-modal-overlay></div><div class=pseudocode-modal-content><div class=pseudocode-modal-header><h3 id=modalTitle-inverted-index class=pseudocode-modal-title>Pseudocode: Inverted Index 'AND' Query Intersection</h3><button class=pseudocode-modal-close aria-label="Close modal">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button></div><div class=pseudocode-modal-body><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>search_and</span><span class=p>(</span><span class=n>query_string</span><span class=p>,</span> <span class=n>inverted_index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1. Tokenize and normalize the query string</span>
</span></span><span class=line><span class=cl>    <span class=n>tokens</span> <span class=o>=</span> <span class=n>tokenize_and_stem</span><span class=p>(</span><span class=n>query_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>tokens</span><span class=p>:</span> <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2. Fetch the posting list (sorted document IDs) for each token</span>
</span></span><span class=line><span class=cl>    <span class=n>posting_lists</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>token</span> <span class=ow>in</span> <span class=n>tokens</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>postings</span> <span class=o>=</span> <span class=n>inverted_index</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>postings</span><span class=p>:</span> <span class=k>return</span> <span class=p>[]</span> <span class=c1># If any word is missing, AND result is empty</span>
</span></span><span class=line><span class=cl>        <span class=n>posting_lists</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>postings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 3. Sort posting lists by length (shortest first) to optimize intersection</span>
</span></span><span class=line><span class=cl>    <span class=n>posting_lists</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=nb>len</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 4. Intersect the shortest list with the subsequent lists</span>
</span></span><span class=line><span class=cl>    <span class=c1># This is a basic 2-pointer intersection algorithm for sorted arrays</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>posting_lists</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>posting_lists</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>current_list</span> <span class=o>=</span> <span class=n>posting_lists</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>new_result</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>p1</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Pointer for the accumulated result</span>
</span></span><span class=line><span class=cl>        <span class=n>p2</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Pointer for the current list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>p1</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=ow>and</span> <span class=n>p2</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>current_list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=n>p1</span><span class=p>]</span> <span class=o>==</span> <span class=n>current_list</span><span class=p>[</span><span class=n>p2</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>new_result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=n>p1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=n>p2</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>result</span><span class=p>[</span><span class=n>p1</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>current_list</span><span class=p>[</span><span class=n>p2</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p2</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>new_result</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=p>:</span> <span class=k>break</span> <span class=c1># Early exit if intersection becomes empty</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span></code></pre></div></div></div></div></div><h3 id=deep-dive>Deep Dive</h3><ul><li><p><strong>Inverted index:</strong> PForDelta-compressed posting lists with positional data use immutable segments and LSM merges to guarantee non-blocking reads.</p></li><li><p><strong>Hybrid ranking:</strong> BM25 lexical candidate generation combines with dense vector semantic embeddings in a two-stage cross-encoder re-ranking pipeline.</p></li><li><p><strong>NRT index refresh:</strong> In-memory segments backed by a WAL refresh every 1‚Äì5 seconds, providing near real-time searchability without synchronous commit costs.</p></li><li><p><strong>Query pipeline:</strong> Resolves synonyms and spelling before utilizing bit-set intersections for facets and ACLs to densely prune before scoring.</p></li><li><p><strong>Relevance feedback loops:</strong> Click-through telemetry implicitly trains learning-to-rank models, aided by an explicit <code>explain</code> API for tuning breakdowns.</p></li><li><p><strong>Security & Multi-tenancy:</strong> Shard-level tenant isolation pairs with Bloom filters on document ACLs to rapidly skip unauthorized tokens during traversal.</p></li></ul><h3 id=trade-offs>Trade-offs</h3><ul><li><p><strong>Lexical vs. Semantic Search:</strong> Lexical (BM25) is fast/interpretable; Semantic (Vector) captures meaning but is GPU-heavy. Hybrid balances both at the cost of complexity.</p></li><li><p><strong>NRT vs. Batch Indexing:</strong> NRT (1‚Äì5s) provides immediate visibility but adds memory/compaction pressure; Batch is more efficient but delays document availability.</p></li><li><p><strong>Scatter-Gather vs. Single-Node:</strong> Scatter-Gather scales horizontally for massive corpora but adds network hops; Single-Node is simpler but limited by machine capacity.</p></li></ul><h2 id=operational-excellence>Operational Excellence</h2><h3 id=slis--slos>SLIs / SLOs</h3><ul><li>SLO: P99 query latency &lt; 50 ms for keyword search; &lt; 150 ms for hybrid (keyword + vector) search.</li><li>SLO: 99.99% availability of the search API.</li><li>SLIs: query_latency_p99, index_freshness_lag, query_error_rate, recall_at_k, shard_replica_lag.</li></ul><h3 id=reliability--resiliency>Reliability & Resiliency</h3><ul><li><strong>Relevance</strong>: Nightly evaluation (NDCG, MAP) against labelled query sets.</li><li><strong>Load</strong>: Test at 2x peak QPS with representative query distributions.</li><li><strong>Chaos</strong>: Kill shard replicas to verify transparent scatter-gather routing.</li></ul></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/deep-dives/ai-ml-workshop/>AI/ML Workshop</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Practical, reproducible ML examples (PyTorch/Hugging Face/NumPy) with MPS-aware benchmarks and experiment hygiene for local hardware.</small></li><li><a href=/systology/principles/algorithms-performance/>Algorithms & Performance</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Principles for clear algorithms and performance engineering: micro-benchmarks, memory discipline, and deterministic generators.</small></li><li><a href=/systology/designs/background-job-queue/>Background Job Queue for Big Tasks</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Asynchronous job queue design for resource-heavy tasks (video encoding, data processing) with retries, idempotency, DLQ handling, and autoscaling.</small></li><li><a href=/systology/deep-dives/chowist/>Chowist</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Monolithic Django app for place listings; focus on production hardening: static serving, background jobs, connection pooling, and CI/CD.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>