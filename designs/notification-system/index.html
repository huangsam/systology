<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Notification System - Systology</title><meta name=description content="Scalable multi-channel notification engine for real-time engagement."><link rel=canonical href=https://sambyte.net/systology/designs/notification-system/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}document.documentElement.setAttribute("data-loading",""),requestAnimationFrame(function(){requestAnimationFrame(function(){document.documentElement.removeAttribute("data-loading")})})</script><style>html{background:#fff;color:#0f1724}html[data-theme=dark]{background:#0f1724;color:#e2e8f0}html[data-loading] *{transition:none!important}</style><link rel=stylesheet href=/systology/css/styles.css><link rel=stylesheet href=/systology/css/syntax.css><link rel=stylesheet href=/systology/css/search.css></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Notification System</h1></div><h2>Scalable multi-channel notification engine for real-time engagement.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/distributed-systems/>distributed-systems</a>
<a class=badge href=/systology/tags/queues/>queues</a></div></header><section><h2 id=problem-statement--constraints>Problem Statement & Constraints</h2><p>Build a central notification system that allows various internal services to send messages across multiple channels (Push, SMS, Email). The system must handle massive spikes (e.g., flash sales, breaking news) while ensuring critical alerts are prioritized over marketing messages.</p><h3 id=functional-requirements>Functional Requirements</h3><ul><li>Send notifications across multiple channels (push, SMS, email).</li><li>Support templating, localization, and user preferences.</li><li>Provide delivery tracking and receipt handling.</li><li>Enforce priority-based queue management.</li></ul><h3 id=non-functional-requirements>Non-Functional Requirements</h3><ul><li><strong>Scale:</strong> Peak volume 100k notifications/minute; handle 10‚Äì100√ó spikes.</li><li><strong>Availability:</strong> 99.9% uptime; graceful degradation during provider outages.</li><li><strong>Consistency:</strong> At-least-once delivery; deduplication for idempotency.</li><li><strong>Latency:</strong> Delivery to external providers within 5 seconds (high-priority).</li><li><strong>Workload Profile:</strong><ul><li>Read:Write ratio: ~20:80</li><li>Peak throughput: 100k notifications/min</li><li>Retention: 30 days delivery logs; 90 days metrics</li></ul></li></ul><h2 id=high-level-architecture>High-Level Architecture</h2><div class=mermaid>graph TD
Services --> API
API --> Router
Router --> HQ[High Q]
Router --> NQ[Normal Q]
Router --> LQ[Low Q]
HQ --> Dispatch
NQ --> Dispatch
LQ --> Dispatch
Dispatch --> Push
Dispatch --> SMS
Dispatch --> Email
Dispatch --> Tracker[(Tracker)]</div><p>Internal services send notification requests to a central API. A Router inspects payloads and routes them into tiered queues (High, Normal, Low) to prevent bulk campaigns from blocking critical alerts. Pluggable Dispatch workers format and deliver messages via external providers, logging statuses to a Tracker database.</p><h2 id=data-design>Data Design</h2><p>Redis Streams or Kafka buffer high-throughput transient payloads and routing metadata. A relational Delivery Tracker durably records receipt statuses and error codes from external providers for operational monitoring.</p><h3 id=notification-queue-redis-streams--kafka>Notification Queue (Redis Streams / Kafka)</h3><table><thead><tr><th style=text-align:left>Field</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>notif_id</code></td><td style=text-align:left>UUID</td><td style=text-align:left>Correlates dispatch with receipt.</td></tr><tr><td style=text-align:left><code>priority</code></td><td style=text-align:left>Enum</td><td style=text-align:left><code>HIGH</code>, <code>NORMAL</code>, <code>BULK</code>.</td></tr><tr><td style=text-align:left><code>payload</code></td><td style=text-align:left>JSON/Proto</td><td style=text-align:left>Rendered content or template variables.</td></tr><tr><td style=text-align:left><code>channel_pref</code></td><td style=text-align:left>List</td><td style=text-align:left><code>[push, email]</code> order of retry.</td></tr></tbody></table><h3 id=delivery-tracker-sql>Delivery Tracker (SQL)</h3><table><thead><tr><th style=text-align:left>Table</th><th style=text-align:left>Column</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>notifications</strong></td><td style=text-align:left><code>id</code></td><td style=text-align:left>UUID (PK)</td><td style=text-align:left>Master ID for tracking.</td></tr><tr><td style=text-align:left><strong>receipts</strong></td><td style=text-align:left><code>notif_id</code></td><td style=text-align:left>UUID (FK)</td><td style=text-align:left>Links to external provider status.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>status</code></td><td style=text-align:left>Enum</td><td style=text-align:left><code>sent</code>, <code>delivered</code>, <code>opened</code>, <code>bounced</code>.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>err_code</code></td><td style=text-align:left>String</td><td style=text-align:left>Provider-specific failure reason.</td></tr></tbody></table><h2 id=deep-dive--trade-offs>Deep Dive & Trade-offs</h2><h3 id=deep-dive>Deep Dive</h3><ul><li><p><strong>Channel adapters:</strong> Pluggable adapters behind a standard <code>Deliver()</code> interface encapsulate complex token management and connection pooling per provider.</p></li><li><p><strong>Template engine & i18n:</strong> Versioned templates use Mustache/Handlebars interpolation, resolving localization via a priority chain (<code>user_locale ‚Üí region_default ‚Üí en</code>).</p></li><li><p><strong>User preferences:</strong> Redis-cached opt-ins, quiet hours, and channel overrides instruct Dispatchers to dynamically drop or defer messages.</p></li><li><p><strong>Double-layer rate limiting:</strong> Global token-buckets enforce provider quotas, while user-level sliding windows block spam and prevent app uninstalls.</p></li><li><p><strong>Delivery tracking:</strong> Adapters ingest provider webhooks to transition outbound message lifecycles (<code>QUEUED ‚Üí DISPATCHED ‚Üí DELIVERED ‚Üí READ</code>) for real-time dashboards.</p></li><li><p><strong>Broadcast fanout:</strong> Workers batch-resolve user segments and enqueue individual messages, avoiding massive payloads and enabling targeted retries for large campaigns.</p></li><li><p><strong>Retries & DLQ:</strong> Failed deliveries retry with exponential backoff. Permanent failures hit a Dead Letter Queue and trigger stale-token cleanups.</p></li></ul><h3 id=trade-offs>Trade-offs</h3><ul><li><p><strong>Per-priority vs. Single Priority Queue:</strong> Separate queues offer better isolation and scaling but higher operational overhead; a single queue is simpler but risks head-of-line blocking.</p></li><li><p><strong>Push vs. Pull (Inbox) Model:</strong> Push is lower latency but requires complex token/offline management; Pull is more reliable but adds read latency and polling infra.</p></li><li><p><strong>Inline vs. Pre-rendering:</strong> Inline allows last-minute A/B testing and personalization but adds dispatch latency; Pre-rendering is faster at dispatch but less flexible.</p></li></ul><h2 id=operational-excellence>Operational Excellence</h2><h3 id=slis--slos>SLIs / SLOs</h3><ul><li>SLO: 99% of high-priority notifications delivered to the external provider within 5 seconds of API receipt.</li><li>SLO: 99.9% overall delivery success rate (excluding user opt-outs and invalid tokens).</li><li>SLIs: dispatch_latency_p95_by_priority, delivery_success_rate, bounce_rate, queue_depth_by_priority, rate_limit_rejection_rate.</li></ul><h3 id=reliability--resiliency>Reliability & Resiliency</h3><ul><li><strong>Integrations</strong>: Validate each channel against provider sandboxes.</li><li><strong>Chaos</strong>: Fail one channel to verify no cross-channel impact.</li><li><strong>Scale</strong>: Load-test fanout worker with 10M-user broadcast batching.</li></ul></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/designs/background-job-queue/>Background Job Queue for Big Tasks</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Asynchronous job queue design for resource-heavy tasks (video encoding, data processing) with retries, idempotency, DLQ handling, and autoscaling.</small></li><li><a href=/systology/designs/distributed-cache/>Distributed Caching Layer for VCS</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design a distributed cache to reduce I/O and speed up VCS operations by caching objects and hashes with high concurrency and low latency.</small></li><li><a href=/systology/designs/web-crawler/>Distributed Web Crawler</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design for a Google-scale web crawler focusing on Breadth-First Search (BFS), DNS resolution caching, robots.txt politeness, and handling duplicate or malicious domains.</small></li><li><a href=/systology/designs/flash-sale/>Flash Sale / Ticketmaster</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design for handling extreme bursts of traffic where limited inventory must be distributed fairly and consistently under heavy load.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>