<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>URL Shortener & Pastebin - Systology</title><meta name=description content="Distributed unique ID generation and read-heavy caching."><link rel=canonical href=https://sambyte.net/systology/designs/url-shortener/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}document.documentElement.setAttribute("data-loading",""),document.addEventListener("DOMContentLoaded",function(){document.documentElement.removeAttribute("data-loading")})</script><style>html{background:#fff;color:#0f1724}html[data-theme=dark]{background:#0f1724;color:#e2e8f0}html[data-loading] *{transition:none!important}</style><link rel=stylesheet href=/systology/css/styles.css><link rel=stylesheet href=/systology/css/syntax.css><link rel=stylesheet href=/systology/css/search.css></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>URL Shortener & Pastebin</h1></div><h2>Distributed unique ID generation and read-heavy caching.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/caching/>caching</a>
<a class=badge href=/systology/tags/database/>database</a>
<a class=badge href=/systology/tags/distributed-systems/>distributed-systems</a>
<a class=badge href=/systology/tags/networking/>networking</a></div></header><section><h2 id=problem-statement--constraints>Problem Statement & Constraints</h2><p>Design a URL shortening service (like TinyURL or bit.ly) or a Pastebin that accepts a long string of data and returns a highly compact, unique alias. When a user navigates to the short alias, they must be seamlessly redirected to the original destination.</p><h3 id=functional-requirements>Functional Requirements</h3><ul><li>Given a long URL, return an alias (e.g., <code>https://sh.rt/8aBc1</code>).</li><li>Redirect an alias to its original URL via HTTP 301/302.</li><li>(Optional) Allow users to specify a custom vanity alias.</li><li>(Optional) Enforce link expiration.</li></ul><h3 id=non-functional-requirements>Non-Functional Requirements</h3><ul><li><strong>Scale:</strong> High read-to-write ratio (100:1). E.g., 100M new URLs per month, 10B redirects per month.</li><li><strong>Availability:</strong> Extremely high availability (99.999%). If redirects fail, all links in the world break.</li><li><strong>Latency:</strong> Redirects must happen in &lt; 10ms.</li><li><strong>Data Retention:</strong> Keep data for 5 years by default. (100M/month * 12 * 5 = 6 Billion links total).</li></ul><h2 id=high-level-architecture>High-Level Architecture</h2><div class=mermaid>graph TD
User([User]) --> Edge[CDN / API Gateway]
%% Write Path
Edge -->|POST /api/v1/data| WriteAPI[Write Service]
WriteAPI --> IDGen[ID Generator<br>Snowflake]
WriteAPI --> DBPrimary[DB Primary]
DBPrimary --> DBReplica[DB Replica]
%% Read Path
Edge -->|GET /8aBc1| EdgeCache[Edge Cache]
EdgeCache -->|Hit| User
EdgeCache -->|Miss| ReadAPI[Read Service]
ReadAPI --> RedisCache[Redis Cache]
RedisCache -->|Hit| ReadAPI
RedisCache -->|Miss| DBReplica</div><p>Reads and writes are logically (or physically) separated. The Write Service relies on a distributed ID generator to avoid database write collisions before converting the numerical ID to a Base62 string. The Read Service heavily leverages a Redis cache (and CDN edge caching) to serve 301 redirects instantly without touching the persistent store.</p><h2 id=data-design>Data Design</h2><h3 id=unique-identifier-math>Unique Identifier Math</h3><p>To store 6 Billion links, we need an alias length. Using Base62 ([a-z, A-Z, 0-9]):</p><ul><li>6 character alias = 62 ^ 6 = ~56.8 Billion possible combinations.
This easily covers the 6 Billion requirement, so a 6 or 7 character string is sufficient.</li></ul><h3 id=storage-schema-nosql-or-sql>Storage Schema (NoSQL or SQL)</h3><table><thead><tr><th style=text-align:left>Column</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>id</code></td><td style=text-align:left>BigInt (PK)</td><td style=text-align:left>Unique numerical ID (from Snowflake or DB sequence).</td></tr><tr><td style=text-align:left><code>hash</code></td><td style=text-align:left>String(7)</td><td style=text-align:left>Base62 encoded version of the ID (e.g., <code>8aBc1</code>). Indexed.</td></tr><tr><td style=text-align:left><code>long_url</code></td><td style=text-align:left>String(2048)</td><td style=text-align:left>The destination.</td></tr><tr><td style=text-align:left><code>created_at</code></td><td style=text-align:left>Timestamp</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>expires_at</code></td><td style=text-align:left>Timestamp</td><td style=text-align:left>For automatic cleanup mechanisms.</td></tr></tbody></table><p><em>Note: Since there are no complex joins, a Wide-Column store like Cassandra/DynamoDB is excellent here, but PostgreSQL is also perfectly fine for 6 Billion rows if partitioned or indexed on the <code>hash</code>.</em></p><h2 id=deep-dive--trade-offs>Deep Dive & Trade-offs</h2><h3 id=deep-dive>Deep Dive</h3><ul><li><strong>ID Generation (Snowflake vs. Auto-Increment):</strong> Using a single PostgreSQL database with an <code>AUTO_INCREMENT</code> primary key creates a massive single point of failure and write bottleneck. Instead, use Twitter&rsquo;s <strong>Snowflake</strong> algorithm: a decentralized microservice that generates unique 64-bit integers based on the current timestamp, a machine ID, and an internal counter. This offers highly available, causally-ordered IDs with zero network coordination.</li><li><strong>Base62 Encoding:</strong> Rather than hashing the URL directly (which requires checking the DB for MD5 collisions), we take the mathematically guaranteed unique <a href=https://en.wikipedia.org/wiki/Snowflake_ID>Snowflake ID</a> (e.g., <code>2009215674938</code>) and simply convert it from Base10 to Base62.</li><li><strong>Custom Vanity Aliases:</strong> When a user requests <code>https://sh.rt/my-sale</code>, the system cannot use the ID Generator. It must attempt to insert the record with a <code>hash</code> of <code>my-sale</code>. If the DB throws a unique constraint violation, the service rejects the request.</li></ul><h3 id=trade-offs>Trade-offs</h3><ul><li><strong>HTTP 301 vs. 302 Redirects:</strong><ul><li><strong>301 (Moved Permanently):</strong> The browser aggressively caches the redirect. This drastically reduces the load on your servers, but you lose the ability to track click analytics (because the browser never contacts your server again for that link).</li><li><strong>302 (Found):</strong> The redirection is temporary. The browser will hit your server every single time. This allows real-time metric tracking at the cost of higher server load and entirely cache-busting the edge.</li></ul></li><li><strong>Hash Collisions (Offline Hashing vs. Ticket Server):</strong> If we used MD5 to hash the long URL and took the first 7 characters, two different URLs might collide on those 7 characters. We would have to append a string and try again (a massive DB performance killer). Generating a unique integer first and encoding it Base62 statistically guarantees 0% collision rate.</li></ul><h2 id=operational-excellence>Operational Excellence</h2><ul><li>SLO: 99.9% of redirects (reads) &lt; 10ms. 99.9% of generation (writes) &lt; 100ms.</li><li>SLIs: <code>cache_hit_ratio</code>, <code>id_generation_exhaustion</code>, <code>redirect_latency_p99</code>.</li><li><strong>Scaling:</strong> If cache hit ratio drops unexpectedly (e.g., a massive spike of <em>distinct</em> URLs rather than one viral URL), the DB read capacity must instantly auto-scale.</li></ul></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/designs/background-job-queue/>Background Job Queue for Big Tasks</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Asynchronous job queue design for resource-heavy tasks (video encoding, data processing) with retries, idempotency, DLQ handling, and autoscaling.</small></li><li><a href=/systology/deep-dives/chowist/>Chowist</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Monolithic Django app for place listings; focus on production hardening: static serving, background jobs, connection pooling, and CI/CD.</small></li><li><a href=/systology/designs/distributed-cache/>Distributed Caching Layer for VCS</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design a distributed cache to reduce I/O and speed up VCS operations by caching objects and hashes with high concurrency and low latency.</small></li><li><a href=/systology/designs/web-crawler/>Distributed Web Crawler</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design for a Google-scale web crawler focusing on Breadth-First Search (BFS), DNS resolution caching, robots.txt politeness, and handling duplicate or malicious domains.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>