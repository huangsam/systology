<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Flash Sale / Ticketmaster - Systology</title><meta name=description content="High-concurrency inventory management for massive traffic spikes."><link rel=canonical href=https://sambyte.net/systology/designs/flash-sale/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><meta property="og:site_name" content="Systology"><meta property="og:title" content="Flash Sale / Ticketmaster - Systology"><meta property="og:description" content="High-concurrency inventory management for massive traffic spikes."><meta property="og:url" content="https://sambyte.net/systology/designs/flash-sale/"><meta property="og:type" content="article"><meta property="article:modified_time" content="2026-02-24T23:08:56-08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Flash Sale / Ticketmaster - Systology"><meta name=twitter:description content="High-concurrency inventory management for massive traffic spikes."><script data-cfasync=false>try{localStorage.getItem("theme")==="dark"&&(document.documentElement.setAttribute("data-theme","dark"),document.documentElement.style.colorScheme="dark")}catch{}</script><style>:root{color-scheme:light;--bg:#ffffff;--text:#0f1724;--muted:#6b7280;--accent:#2563eb;--accent-weak:rgba(37, 99, 235, 0.08);--accent-weak-up:rgba(37, 99, 235, 0.15);--border:#e6e9ee;--blockquote-bg:#f8fafc;--radius:10px;--max-width:48rem;--focus:3px rgba(37, 99, 235, 0.18);--link-gap:0.5rem;--gutter:0.75rem;--color-warning:#d97706;--color-success:#059669;--space-nano:0.05rem;--space-micro:0.125rem;--space-xs:0.25rem;--space-xs-plus:0.35rem;--space-sm:0.5rem;--space-sm-plus:0.625rem;--space-md:0.75rem;--space-md-plus:0.875rem;--space-lg:1rem;--space-lg-plus:1.1rem;--space-xl:1.25rem;--space-2xl:1.5rem;--space-3xl:2rem;--space-3xl-plus:2.25rem;--space-4xl:2.5rem}[data-theme=dark]{color-scheme:dark;--bg:#0f1724;--text:#e2e8f0;--muted:#94a3b8;--accent:#60a5fa;--accent-weak:rgba(96, 165, 250, 0.1);--accent-weak-up:rgba(96, 165, 250, 0.2);--border:#1e293b;--blockquote-bg:#1a2332;--focus:3px rgba(96, 165, 250, 0.25);--color-warning:#fbbf24;--color-success:#34d399}html{scrollbar-gutter:stable}*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif;line-height:1.75;font-size:16px;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;overflow-anchor:none;min-height:100svh;display:grid;grid-template-rows:auto 1fr auto}.container{width:100%;max-width:var(--max-width);margin:0 auto;padding:0 var(--gutter)}main.container{padding-top:var(--space-lg);padding-bottom:var(--space-2xl)}:focus-visible{outline:var(--focus);outline-offset:var(--space-xs)}.theme-toggle{display:inline-flex;align-items:center;justify-content:center;width:var(--space-3xl);height:var(--space-3xl);padding:0;border:1px solid var(--border);border-radius:8px;background:0 0;color:var(--muted);cursor:pointer}.theme-toggle:hover,.theme-toggle:focus-visible{color:var(--accent);border-color:var(--accent);background:var(--accent-weak)}.theme-toggle svg{width:var(--space-lg-plus);height:var(--space-lg-plus)}.theme-toggle .icon-sun{display:none}.theme-toggle .icon-moon{display:block}[data-theme=dark] .theme-toggle .icon-sun{display:block}[data-theme=dark] .theme-toggle .icon-moon{display:none}.pagination{display:flex;justify-content:center;gap:var(--space-lg);margin:var(--space-3xl)0 var(--space-lg)}.pagination a{display:inline-flex;align-items:center;padding:var(--space-sm)var(--space-xl);border:1px solid var(--border);border-radius:6px;color:var(--accent);text-decoration:none;font-size:.95rem;font-weight:500}.pagination a:hover,.pagination a:focus-visible{background:var(--accent-weak);border-color:var(--accent);box-shadow:0 2px 8px rgba(37,99,235,8%)}.card,.post-card{background:linear-gradient(0deg,rgba(0,0,0,1%),rgba(0,0,0,1%));border:1px solid var(--border);border-radius:12px}.card{padding:var(--space-lg)}.post-card{padding:var(--space-xl);display:flex;flex-direction:column;gap:var(--space-md)}.post-card h3{margin:0;font-size:1.1rem;line-height:1.3}.post-card h3 a{text-decoration:none}.post-card h3 a:hover{text-decoration:underline}.post-card .summary{margin:0;color:var(--text);font-size:.95rem;line-height:1.5}.posts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:var(--space-2xl);margin:var(--space-2xl)0}.badge{display:inline-flex;align-items:center;gap:var(--space-xs);padding:var(--space-xs).625rem;background:var(--accent-weak);border:1px solid rgba(37,99,235,.2);border-radius:6px;color:var(--accent);text-decoration:none;font-size:.9rem;font-weight:500}.title-group{display:flex;align-items:center;flex-wrap:wrap;gap:var(--space-lg)}.title-group>*{margin:var(--space-sm)0}.title-group .draft-badge,.title-group .link-pill{font-size:.75rem}.badge:hover,.badge:focus{background:rgba(37,99,235,.15);border-color:var(--accent)}.draft-badge{display:inline-flex;align-items:center;padding:var(--space-micro)var(--space-sm);background:rgba(217,119,6,.1);border:1px solid rgba(217,119,6,.3);border-radius:4px;color:var(--color-warning);font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em}[data-theme=dark] .draft-badge{background:rgba(251,191,36,.1);border-color:rgba(251,191,36,.3)}.link-pill{display:inline-flex;align-items:center;padding:var(--space-micro)var(--space-sm);background:var(--accent-weak);border:1px solid rgba(37,99,235,.2);border-radius:4px;color:var(--accent);text-decoration:none;font-size:.75rem;font-weight:700;letter-spacing:.05em}.link-pill:hover,.link-pill:focus{background:rgba(37,99,235,.15);border-color:var(--accent)}.term-pill{display:inline-flex;align-items:center;gap:var(--space-sm);padding:var(--space-sm)var(--space-md-plus);background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);text-decoration:none;color:var(--text);font-size:.95rem;font-weight:500}.term-pill:hover,.term-pill:focus-visible{border-color:var(--accent);background:var(--accent-weak);transform:translateY(-1px);box-shadow:0 4px 12px rgba(37,99,235,8%)}.term-pill .count{font-size:.8rem;background:var(--bg);color:var(--muted);padding:var(--space-micro)var(--space-sm);border-radius:6px;border:1px solid var(--border)}.term-pill:hover .count{border-color:rgba(37,99,235,.2);color:var(--accent)}.terms-pills{display:flex;flex-wrap:wrap;gap:var(--space-md);margin:var(--space-3xl)0}.label-tag,.label-cat{padding:var(--space-nano)var(--space-xs-plus);border-radius:4px;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.02em}.label-tag{background:var(--accent-weak);color:var(--accent);border:1px solid rgba(37,99,235,.2)}.label-cat{background:rgba(5,150,105,.1);color:var(--color-success);border:1px solid rgba(5,150,105,.2)}[data-theme=dark] .label-cat{background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.2)}.prose h1{font-size:2rem;line-height:1.05}.prose h2{font-size:1.5rem}.prose h3{font-size:1.15rem}.prose p{margin:.6rem 0}.prose ul,.prose ol{margin:var(--space-md)0}.prose li{margin-bottom:var(--space-sm);padding-left:var(--space-xs)}.prose a{color:var(--accent);text-decoration:underline;text-underline-offset:3px}.prose a.term-pill{text-decoration:none}.prose img{max-width:100%;height:auto;border-radius:8px;display:block;margin:var(--space-md)0}code{background:rgba(37,99,235,8%);padding:.15rem var(--space-xs-plus);border-radius:6px;border:1px solid rgba(37,99,235,.15);font-size:.94em;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,roboto mono,courier new,monospace}pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,roboto mono,courier new,monospace;padding:var(--space-lg);border-radius:var(--radius);background:var(--bg);border:1px solid var(--border);color:var(--text);overflow:auto;margin:var(--space-lg)0;box-shadow:0 2px 8px rgba(0,0,0,4%)}pre code{background:0 0;padding:0;color:inherit;border:none}[data-theme=dark] pre{background:var(--blockquote-bg);border-color:var(--border);color:var(--text)}[data-theme=dark] code{background:var(--accent-weak);border-color:var(--accent-weak-up)}blockquote{margin:var(--space-lg)0;padding:.6rem var(--space-lg);border-left:4px solid var(--border);background:var(--blockquote-bg);color:var(--muted);border-radius:6px}table{width:100%;border-collapse:collapse;margin:var(--space-lg)0;font-size:.95rem}th,td{padding:var(--space-sm).75rem;border-bottom:1px solid var(--border);text-align:left}th{color:var(--muted);font-weight:600}.site-header{border-bottom:1px solid var(--border);background:0 0}.site-header .container{display:flex;align-items:center;justify-content:space-between;gap:var(--space-lg);padding-top:var(--space-lg);padding-bottom:var(--space-lg)}.brand{font-weight:700;font-size:1.125rem;color:var(--text);text-decoration:none;display:flex;align-items:center;gap:var(--space-sm)}.logo-icon{width:1.5rem;height:1.5rem}.site-nav{display:flex;gap:var(--link-gap);align-items:center}.site-nav a{color:var(--muted);text-decoration:none;font-size:.95rem;padding:var(--space-xs).375rem;border-radius:6px}.site-nav a:hover,.site-nav a:focus{color:var(--accent);background:var(--accent-weak);outline:transparent}.site-footer{border-top:1px solid var(--border);color:var(--muted);font-size:.95rem;padding:var(--space-lg)0 var(--space-2xl)}.footer-inner{display:flex;justify-content:space-between;align-items:center;gap:var(--space-lg)}.footer-inner .copyright{margin:0}.social-links{display:flex;gap:var(--space-sm);align-items:center}.social-links a{color:var(--muted);padding:var(--space-xs).375rem;border-radius:6px;display:flex;align-items:center;justify-content:center}.social-links a:hover,.social-links a:focus{color:var(--accent);background:var(--accent-weak);transform:translateY(-1px)}.prose article>header{margin-bottom:var(--space-lg)}.prose article>header h2{margin:.25rem 0 .75rem;font-weight:600;font-size:1.125rem}.prose article>header div.tags{margin:var(--space-sm)0}div.tags{display:flex;flex-wrap:wrap;gap:var(--space-md);align-items:center;margin:var(--space-md)0}div.tags>span{font-weight:600;color:var(--text)}span.muted{margin-left:.125rem}.mermaid{margin:var(--space-2xl)0;padding:var(--space-lg);background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);overflow:auto}.mermaid svg{max-width:100%;height:auto;display:block;margin:0 auto}.mermaid .edgePath .path{stroke:var(--accent);stroke-width:2}.mermaid .flowchart-link{stroke:var(--muted);stroke-width:1.5}.mermaid text{fill:var(--text);font-family:inherit}[data-theme=dark] .mermaid{background:var(--blockquote-bg);border-color:var(--border)}[data-theme=dark] .mermaid .flowchart-link{stroke:var(--text)!important}[data-theme=dark] .mermaid .marker{stroke:var(--text)!important;fill:var(--text)!important}.related{margin-top:var(--space-4xl);padding-top:var(--space-2xl);border-top:1px solid var(--border)}.related h3{font-size:1.05rem;margin:0 0 .75rem;color:var(--muted);font-weight:600;letter-spacing:.02em;text-transform:uppercase}.related ul{list-style:none;padding:0;margin:0;display:grid;gap:var(--space-sm)}.related li{padding:var(--space-sm)0}.related a{font-weight:500;text-decoration:none;color:var(--accent)}.related a:hover{text-decoration:underline}.related .muted{color:var(--muted);font-size:.88rem}.related-type{display:inline-flex;gap:var(--space-sm);margin-left:var(--space-sm);vertical-align:middle}.listing{list-style:none;padding:0;margin:var(--space-2xl)0}.listing li{padding:.625rem 0;border-bottom:1px solid var(--border)}.listing li:last-child{border-bottom:none}.listing a{font-weight:500}.listing .draft-badge{margin-left:var(--space-sm)}.meta{color:var(--muted);font-size:.9rem}@media(max-width:640px){:root{--gutter:var(--space-md)}.brand{font-size:var(--space-lg)}.logo-icon{width:var(--space-xl);height:var(--space-xl)}main.container{padding-top:var(--space-sm);padding-bottom:var(--space-sm)}.footer-inner{flex-direction:column;justify-content:center;gap:var(--space-md)}}@media(min-width:641px) and (max-width:700px){:root{--gutter:var(--space-xl)}}.pseudocode-container{margin:var(--space-lg)0}.pseudocode-toggle{display:inline-flex;align-items:center;gap:var(--space-sm);padding:var(--space-sm)var(--space-lg);background:var(--accent-weak);border:1px solid rgba(37,99,235,.2);border-radius:var(--radius);color:var(--accent);font-weight:500;cursor:pointer}.pseudocode-toggle:hover,.pseudocode-toggle:focus-visible{background:var(--accent-weak-up);border-color:var(--accent);transform:translateY(-1px)}[data-theme=dark] .pseudocode-toggle{border:1px solid rgba(96,165,250,.2)}.pseudocode-modal{display:none;position:fixed;inset:0;z-index:1000;align-items:center;justify-content:center}.pseudocode-modal.active{display:flex}.pseudocode-modal-overlay{position:absolute;inset:0;background:rgba(15,23,36,.5);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);transition:opacity .2s ease}[data-theme=dark] .pseudocode-modal-overlay{background:rgba(0,0,0,.6)}.pseudocode-modal-content{position:relative;width:100%;max-width:800px;max-height:85vh;margin:0 var(--space-md);background:var(--bg);border:1px solid var(--border);border-radius:12px;box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,4%);display:flex;flex-direction:column;overflow:hidden;z-index:1001;animation:modalIn .2s cubic-bezier(.16,1,.3,1)}[data-theme=dark] .pseudocode-modal-content{box-shadow:0 20px 25px -5px rgba(0,0,0,.5),0 10px 10px -5px rgba(0,0,0,.25)}@keyframes modalIn{from{opacity:0;transform:scale(.95)translateY(10px)}to{opacity:1;transform:scale(1)translateY(0)}}.pseudocode-modal-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-md)var(--space-xl);border-bottom:1px solid var(--border);background:var(--bg)}.pseudocode-modal-title{margin:0;font-size:1.1rem;font-weight:600;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pseudocode-modal-close{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:0 0;border:none;border-radius:6px;color:var(--muted);cursor:pointer;padding:0;margin-left:var(--space-md);flex-shrink:0}.pseudocode-modal-close:hover,.pseudocode-modal-close:focus-visible{background:rgba(239,68,68,.1);color:#ef4444}.pseudocode-modal-body{padding:0 var(--space-xl)var(--space-xl);overflow-y:auto;overscroll-behavior:contain;font-size:.85rem}.pseudocode-modal-body pre{margin:var(--space-md)0}.bg{color:#fff;background-color:#000}.chroma{color:#fff;background-color:#000;-webkit-text-size-adjust:none}.chroma .lnlinks{outline:none;text-decoration:none;color:inherit}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:#191919}.chroma .lnt{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .line{display:flex}.chroma .k{color:#b6a0ff}.chroma .kc{color:#00bcff}.chroma .kd{color:#b6a0ff}.chroma .kn{color:#b6a0ff}.chroma .kp{color:#b6a0ff}.chroma .kr{color:#b6a0ff}.chroma .kt{color:#6ae4b9}.chroma .nb{color:#f78fe7}.chroma .bp{color:#f78fe7}.chroma .nv{color:#00d3d0}.chroma .vc{color:#00d3d0}.chroma .vg{color:#00d3d0}.chroma .vi{color:#00d3d0}.chroma .vm{color:#00d3d0}.chroma .nf{color:#feacd0}.chroma .fm{color:#feacd0}.chroma .l{color:#00bcff}.chroma .ld{color:#00bcff}.chroma .s{color:#79a8ff}.chroma .sa{color:#79a8ff}.chroma .sb{color:#79a8ff}.chroma .sc{color:#79a8ff}.chroma .dl{color:#79a8ff}.chroma .sd{color:#79a8ff}.chroma .s2{color:#79a8ff}.chroma .se{color:#79a8ff}.chroma .sh{color:#79a8ff}.chroma .si{color:#79a8ff}.chroma .sx{color:#79a8ff}.chroma .sr{color:#79a8ff}.chroma .s1{color:#79a8ff}.chroma .ss{color:#79a8ff}.chroma .m{color:#00bcff}.chroma .mb{color:#00bcff}.chroma .mf{color:#00bcff}.chroma .mh{color:#00bcff}.chroma .mi{color:#00bcff}.chroma .il{color:#00bcff}.chroma .mo{color:#00bcff}.chroma .o{color:#00d3d0}.chroma .ow{color:#00d3d0}.chroma .c{color:#a8a8a8}.chroma .ch{color:#a8a8a8}.chroma .cm{color:#a8a8a8}.chroma .c1{color:#a8a8a8}.chroma .cs{color:#a8a8a8}.chroma .cp{color:#a8a8a8}.chroma .cpf{color:#a8a8a8}</style></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=theme-toggle onclick='window.location.href="/systology/tags/"' aria-label=Tags>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
</button>
<button class=theme-toggle onclick='window.location.href="/systology/categories/"' aria-label=Categories>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Flash Sale / Ticketmaster</h1></div><h2>High-concurrency inventory management for massive traffic spikes.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/algorithms/>algorithms</a>
<a class=badge href=/systology/tags/concurrency/>concurrency</a>
<a class=badge href=/systology/tags/database/>database</a>
<a class=badge href=/systology/tags/distributed-systems/>distributed-systems</a></div></header><section><h2 id=problem-statement--constraints>Problem Statement & Constraints</h2><p>Design a ticketing or flash sale system capable of handling millions of users simultaneously trying to purchase a limited set of items (e.g., concert tickets). The system must prevent over-selling, ensure fair access (e.g., virtual waiting rooms), and maintain stable performance during extreme traffic bursts.</p><h3 id=functional-requirements>Functional Requirements</h3><ul><li>Browse inventory and product details.</li><li>Reserve items with time-limited holds.</li><li>Complete purchases with payment processing.</li><li>Manage a virtual waiting room for fair queue management.</li></ul><h3 id=non-functional-requirements>Non-Functional Requirements</h3><ul><li><strong>Scale:</strong> Handle 1M concurrent users; limited inventory (e.g., 100k tickets).</li><li><strong>Availability:</strong> 99.99% uptime for sale event duration.</li><li><strong>Consistency:</strong> Linearizable consistency for inventory counts; no double-selling.</li><li><strong>Latency:</strong> Inventory check and reservation &lt; 500ms under peak load.</li><li><strong>Workload Profile:</strong><ul><li>Read:Write ratio: ~80:20</li><li>Peak throughput: 1M requests/sec</li><li>Retention: 30 days post-event</li></ul></li></ul><h2 id=high-level-architecture>High-Level Architecture</h2><div class=mermaid>graph TD
Users --> Edge
Edge --> WaitRoom[Wait Room]
WaitRoom --> GW[Gateway]
GW --> Reserve
Reserve --> Redis[(Redis)]
Reserve --> Orders[(Orders)]
GW --> Payment
Payment --> Orders</div><p>The CDN/Edge layer queues bursting traffic into a Virtual Waiting Room. Admitted users pass through an API Gateway to a Reservation service that atomically claims inventory in Redis and writes a temporary hold to the sharded Orders DB. Checkout via the Payment service converts holds into confirmed orders.</p><h2 id=data-design>Data Design</h2><p>Redis provides a high-speed volatile cache for atomic inventory counters and short-lived idempotency keys. The SQL Orders database provides durable transactional truth, utilizing optimistic concurrency control to handle write bursts safely.</p><h3 id=inventory-key-space-redis>Inventory Key-Space (Redis)</h3><table><thead><tr><th style=text-align:left>Key Pattern</th><th style=text-align:left>Value Type</th><th style=text-align:left>Description</th><th style=text-align:left>TTL</th></tr></thead><tbody><tr><td style=text-align:left><code>inv:&lt;sku_id></code></td><td style=text-align:left>Integer</td><td style=text-align:left>Atomic counter for available items.</td><td style=text-align:left>Event duration</td></tr><tr><td style=text-align:left><code>hold:&lt;sku_id>:&lt;user_id></code></td><td style=text-align:left>String</td><td style=text-align:left>Reservation lock / owner ID.</td><td style=text-align:left>10 minutes</td></tr><tr><td style=text-align:left><code>idemp:&lt;key></code></td><td style=text-align:left>String</td><td style=text-align:left>Idempotency key for deduplication.</td><td style=text-align:left>15 minutes</td></tr></tbody></table><h3 id=order-schema-sql>Order Schema (SQL)</h3><table><thead><tr><th style=text-align:left>Table</th><th style=text-align:left>Column</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>orders</strong></td><td style=text-align:left><code>id</code></td><td style=text-align:left>UUID (PK)</td><td style=text-align:left>Unique order identifier.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>user_id</code></td><td style=text-align:left>UUID (FK)</td><td style=text-align:left>Buyer identifier.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>sku_id</code></td><td style=text-align:left>String</td><td style=text-align:left>Purchased item ID.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>status</code></td><td style=text-align:left>Enum</td><td style=text-align:left><code>pending</code>, <code>confirmed</code>, <code>expired</code>.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>version</code></td><td style=text-align:left>Integer</td><td style=text-align:left>For optimistic concurrency control.</td></tr></tbody></table><h2 id=deep-dive--trade-offs>Deep Dive & Trade-offs</h2><div class=pseudocode-container><button class=pseudocode-toggle aria-expanded=false aria-controls=atomic-inventory>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
View Pseudocode: Atomic Inventory Deduction (Redis Lua)</button><div id=atomic-inventory class=pseudocode-modal aria-hidden=true role=dialog aria-labelledby=modalTitle-atomic-inventory><div class=pseudocode-modal-overlay></div><div class=pseudocode-modal-content><div class=pseudocode-modal-header><h3 id=modalTitle-atomic-inventory class=pseudocode-modal-title>Pseudocode: Atomic Inventory Deduction (Redis Lua)</h3><button class=pseudocode-modal-close aria-label="Close modal">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button></div><div class=pseudocode-modal-body><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect to Redis cluster</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Lua script to check inventory and deduct atomically</span>
</span></span><span class=line><span class=cl><span class=c1># ARGV[1] = requested amount</span>
</span></span><span class=line><span class=cl><span class=n>LUA_RESERVE_SCRIPT</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>local inventory_key = KEYS[1]
</span></span></span><span class=line><span class=cl><span class=s2>local req_amount = tonumber(ARGV[1])
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>local current = tonumber(redis.call(&#39;GET&#39;, inventory_key) or &#39;0&#39;)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>if current &gt;= req_amount then
</span></span></span><span class=line><span class=cl><span class=s2>    redis.call(&#39;DECRBY&#39;, inventory_key, req_amount)
</span></span></span><span class=line><span class=cl><span class=s2>    return 1 -- Success
</span></span></span><span class=line><span class=cl><span class=s2>else
</span></span></span><span class=line><span class=cl><span class=s2>    return 0 -- Failed: Not enough inventory
</span></span></span><span class=line><span class=cl><span class=s2>end
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Register script to avoid parsing it on every call</span>
</span></span><span class=line><span class=cl><span class=n>reserve_inventory</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>register_script</span><span class=p>(</span><span class=n>LUA_RESERVE_SCRIPT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_reserve</span><span class=p>(</span><span class=n>sku_id</span><span class=p>,</span> <span class=n>amount_needed</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Executes atomically: guarantees no race condition between GET and DECR</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=o>=</span> <span class=n>reserve_inventory</span><span class=p>(</span><span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;inv:</span><span class=si>{</span><span class=n>sku_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>],</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=n>amount_needed</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>success</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Proceed with reservation hold logic (Phase 1)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>create_hold</span><span class=p>(</span><span class=n>sku_id</span><span class=p>,</span> <span class=n>amount_needed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Sold out or not enough inventory&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div></div></div></div><h3 id=deep-dive>Deep Dive</h3><ul><li><p><strong>Virtual waiting room:</strong> Token-bucket batch admission smooths the thundering herd, redirecting excess traffic to static polling pages.</p></li><li><p><strong>Atomic inventory:</strong> Redis Lua scripts safely <code>DECR</code> counters only if ≥ 0, achieving high concurrency without SQL row-level locks.</p></li><li><p><strong>Two-phase purchase:</strong> Phase 1 reserves inventory with a TTL; Phase 2 confirms on payment. A background reaper recycles expired holds.</p></li><li><p><strong>Edge load shedding:</strong> Edge IP rate limits and API gateway backend-concurrency shedding (503 Retry-After) protect the core.</p></li><li><p><strong>Sharded Order DB:</strong> Horizontal sharding by <code>order_id</code> combined with optimistic concurrency control distributes the massive write-burst.</p></li><li><p><strong>Idempotent requests:</strong> Short-lived Redis deduplication of client-generated keys prevents double-charges from network retries.</p></li><li><p><strong>Bot mitigation:</strong> Waiting-room CAPTCHAs, device fingerprinting, and behavioral analysis block automated scalpers.</p></li></ul><h3 id=trade-offs>Trade-offs</h3><ul><li><p><strong>Redis vs. DB Locks:</strong> Redis is faster for hot counters but riskier on state loss; DB locks are durable but create massive contention bottlenecks under peak load.</p></li><li><p><strong>Waiting Room vs. Rate Limiting:</strong> Waiting rooms provide a fair experience but add latency; pure rate limiting is simpler but results in random, frustrating rejections.</p></li><li><p><strong>Reservation TTL Length:</strong> Short TTLs recycle inventory faster but risk timeouts; long TTLs are user-friendly but can keep inventory &ldquo;hostage&rdquo; if users abandon.</p></li></ul><h2 id=operational-excellence>Operational Excellence</h2><h3 id=slis--slos>SLIs / SLOs</h3><ul><li>SLO: 99.9% of admitted users can complete a reservation within 500 ms.</li><li>SLO: 0% over-sell rate (linearizable inventory accuracy).</li><li>SLIs: reservation_latency_p99, inventory_accuracy (Redis vs. Order DB reconciliation), waiting_room_admission_rate, payment_success_rate, abandoned_reservation_rate.</li></ul><h3 id=reliability--resiliency>Reliability & Resiliency</h3><ul><li><strong>Load</strong>: Test at 2x peak (2M users) in staging before each event.</li><li><strong>Chaos</strong>: Kill Redis primary and verify Sentinel failover without data loss.</li><li><strong>Reaper</strong>: End-to-end test TTL reaper to ensure hold recycling.</li></ul></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/principles/algorithms-performance/>Algorithms & Performance</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Principles for clear algorithms and performance engineering: micro-benchmarks, memory discipline, and deterministic generators.</small></li><li><a href=/systology/designs/distributed-cache/>Distributed Caching Layer for VCS</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design a distributed cache to reduce I/O and speed up VCS operations by caching objects and hashes with high concurrency and low latency.</small></li><li><a href=/systology/designs/web-crawler/>Distributed Web Crawler</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design for a Google-scale web crawler focusing on Breadth-First Search (BFS), DNS resolution caching, robots.txt politeness, and handling duplicate or malicious domains.</small></li><li><a href=/systology/deep-dives/grit/>Grit</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>From‑scratch Git implementation in Rust focusing on object storage, performance, and plumbing/porcelain command compatibility.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=/systology/index.xml aria-label="RSS Feed"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg>
</a><a href=/systology/sitemap.xml aria-label=Sitemap><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
</a><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-content");n&&(n.setAttribute("tabindex","-1"),n.focus())}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>