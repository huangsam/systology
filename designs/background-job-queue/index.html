<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Background Job Queue for Big Tasks - Systology</title><meta name=description content="Async job for videos and data processing."><link rel=canonical href=https://sambyte.net/systology/designs/background-job-queue/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>(function(){try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}var e=document.createElement("style");e.id="no-fouc",e.textContent="*, *::before, *::after { transition: none !important; }",document.head.appendChild(e),requestAnimationFrame(function(){requestAnimationFrame(function(){var e=document.getElementById("no-fouc");e&&e.parentNode.removeChild(e)})})})()</script><link rel=stylesheet href="/systology/css/styles.css?v=1772223310"><link rel=stylesheet href="/systology/css/syntax.css?v=1772223310"><link rel=stylesheet href="/systology/css/search.css?v=1772223310"></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Background Job Queue for Big Tasks</h1></div><h2>Async job for videos and data processing.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/concurrency/>concurrency</a>
<a class=badge href=/systology/tags/distributed-systems/>distributed-systems</a>
<a class=badge href=/systology/tags/monitoring/>monitoring</a>
<a class=badge href=/systology/tags/networking/>networking</a>
<a class=badge href=/systology/tags/queues/>queues</a></div></header><section><h2 id=problem-statement--constraints>Problem Statement & Constraints</h2><p>Create an asynchronous job queue system to handle resource-intensive tasks like video encoding or data processing, ensuring reliable execution with retries and idempotency. The system must scale to manage thousands of jobs concurrently, provide visibility into job status, and maintain high availability without impacting the main application performance.</p><h3 id=functional-requirements>Functional Requirements</h3><ul><li>Queue tasks (e.g., video encoding, data processing).</li><li>Process tasks asynchronously with retry logic.</li><li>Provide visibility into job status and failure handling.</li></ul><h3 id=non-functional-requirements>Non-Functional Requirements</h3><ul><li><strong>Scale:</strong> 10k jobs/hour; concurrent task processing capacity.</li><li><strong>Availability:</strong> 99.9% job completion reliability.</li><li><strong>Consistency:</strong> Idempotent operations; no duplicate processing.</li><li><strong>Latency:</strong> Job start time &lt; 5 minutes after queue.</li><li><strong>Workload Profile:</strong><ul><li>Read:Write ratio: ~50:50</li><li>Peak throughput: 10 jobs/sec</li><li>Retention: 30 days</li></ul></li></ul><h2 id=high-level-architecture>High-Level Architecture</h2><div class=mermaid>graph LR
Client --> API
API --> Queue
Queue --> Worker
Worker --> Storage
Worker --> DB
DB --> Dashboard</div><p>Clients submit jobs via an API to a durable queue. Pull-based workers execute tasks, writing payloads to object storage. Worker status and job metadata are synced to a relational database, powering a real-time operational dashboard.</p><h2 id=data-design>Data Design</h2><p>Message brokers buffer the high-throughput primary job queue. A relational database tracks idempotency and execution status. Large payloads reside in an external blob store, referenced via URI to keep messages small.</p><h3 id=job-message-format-redis-streams--sqs>Job Message Format (Redis Streams / SQS)</h3><table><thead><tr><th style=text-align:left>Field</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>job_id</code></td><td style=text-align:left>UUID</td><td style=text-align:left>Unique identifier for the job instance.</td></tr><tr><td style=text-align:left><code>task_type</code></td><td style=text-align:left>String</td><td style=text-align:left>e.g., <code>transcode_v1</code>, <code>batch_report_v2</code>.</td></tr><tr><td style=text-align:left><code>payload_ref</code></td><td style=text-align:left>URI</td><td style=text-align:left>S3 path to the large payload (if applicable).</td></tr><tr><td style=text-align:left><code>retries</code></td><td style=text-align:left>Int</td><td style=text-align:left>Current attempt count.</td></tr></tbody></table><h3 id=job-status-store-sql>Job Status Store (SQL)</h3><table><thead><tr><th style=text-align:left>Table</th><th style=text-align:left>Column</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>jobs</strong></td><td style=text-align:left><code>id</code></td><td style=text-align:left>UUID (PK)</td><td style=text-align:left>Unique job ID.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>status</code></td><td style=text-align:left>Enum</td><td style=text-align:left><code>pending</code>, <code>running</code>, <code>success</code>, <code>failed</code>.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>result_url</code></td><td style=text-align:left>String</td><td style=text-align:left>Link to output artifact.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>error_log</code></td><td style=text-align:left>Text</td><td style=text-align:left>Last error message for DLQ inspection.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>owner_id</code></td><td style=text-align:left>UUID (Idx)</td><td style=text-align:left>Identifying the worker currently leasing.</td></tr></tbody></table><h2 id=deep-dive--trade-offs>Deep Dive & Trade-offs</h2><h3 id=deep-dive>Deep Dive</h3><ul><li><p><strong>Queue backend:</strong> Redis Streams offers low-latency; Kafka/SQS scale massively with native replayability.</p></li><li><p><strong>Worker model:</strong> Pull-based workers use visibility timeouts and heartbeats, with local resource limits to ensure stability.</p></li><li><p><strong>Idempotency:</strong> Unique deduction keys and persistent database statuses prevent duplicate processing.</p></li><li><p><strong>Retries & DLQ:</strong> Jobs retry using exponential backoff with jitter before routing to a Dead-Letter Queue (DLQ).</p></li><li><p><strong>Priority & QoS:</strong> Dedicated queues isolate latency-sensitive from batch jobs. Token-bucket rate limits protect downstream services.</p></li><li><p><strong>Autoscaling:</strong> Workers scale independently per job type based on queue depth and CPU utilization.</p></li><li><p><strong>Isolation:</strong> Untrusted jobs execute in sandboxed containers with strict resource quotas.</p></li></ul><h3 id=trade-offs>Trade-offs</h3><ul><li><p><strong>Redis Streams vs. Kafka/SQS:</strong> Redis is faster/simpler; Kafka/SQS scales better for multi-day retention and multi-consumer reprocessing.</p></li><li><p><strong>Inline vs. External Payloads:</strong> Inline is simpler but adds bloat; External (S3) is robust for large files but increases architectural complexity.</p></li></ul><h2 id=operational-excellence>Operational Excellence</h2><h3 id=slis--slos>SLIs / SLOs</h3><ul><li>SLO: 99% of jobs start processing within 5 minutes of enqueue.</li><li>SLO: 99.9% of jobs succeed (or move to DLQ) within configured retry policy.</li><li>SLIs: queue_depth, job_start_latency_p95, job_completion_latency_p99, job_success_rate (1m/5m windows).</li></ul><h3 id=reliability--resiliency>Reliability & Resiliency</h3><ul><li><strong>Load/Chaos</strong>: Test worker crashes, storage latency, and network partitions.</li><li><strong>Idempotency</strong>: Verify retry semantics and duplicate prevention via integration tests.</li><li><strong>Canary</strong>: Roll out job handler changes to 5% traffic before full promotion.</li></ul></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/deep-dives/chowist/>Chowist</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Monolithic Django app for place listings; focus on production hardening: static serving, background jobs, connection pooling, and CI/CD.</small></li><li><a href=/systology/designs/distributed-cache/>Distributed Caching Layer for VCS</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design a distributed cache to reduce I/O and speed up VCS operations by caching objects and hashes with high concurrency and low latency.</small></li><li><a href=/systology/designs/web-crawler/>Distributed Web Crawler</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design for a Google-scale web crawler focusing on Breadth-First Search (BFS), DNS resolution caching, robots.txt politeness, and handling duplicate or malicious domains.</small></li><li><a href=/systology/designs/migration-dedup/>End-to-End Migration & Deduplication</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>System design for migrating large datasets with deduplication, integrity checks, resumability, and idempotence.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>