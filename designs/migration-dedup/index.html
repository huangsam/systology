<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>End-to-End Migration & Deduplication - Systology</title><meta name=description content="Large-scale data migration and dedup."><link rel=canonical href=https://sambyte.net/systology/designs/migration-dedup/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}document.documentElement.setAttribute("data-loading",""),document.addEventListener("DOMContentLoaded",function(){document.documentElement.removeAttribute("data-loading")})</script><style>html{background:#fff;color:#0f1724}html[data-theme=dark]{background:#0f1724;color:#e2e8f0}html[data-loading] *{transition:none!important}</style><link rel=stylesheet href=/systology/css/styles.css><link rel=stylesheet href=/systology/css/syntax.css><link rel=stylesheet href=/systology/css/search.css></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>End-to-End Migration & Deduplication</h1></div><h2>Large-scale data migration and dedup.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/deduplication/>deduplication</a>
<a class=badge href=/systology/tags/networking/>networking</a></div></header><section><h2 id=problem-statement--constraints>Problem Statement & Constraints</h2><p>Create a system to migrate large volumes of data between systems while performing deduplication to eliminate redundant entries, ensuring data integrity and efficiency. The process must be idempotent, support rollback capabilities, and complete within specified timeframes, handling potential failures gracefully in a scalable manner.</p><h3 id=functional-requirements>Functional Requirements</h3><ul><li>Migrate data between source and target systems.</li><li>Detect and eliminate duplicate records during migration.</li><li>Provide resumability and rollback capabilities.</li><li>Reconcile source and target post-migration.</li></ul><h3 id=non-functional-requirements>Non-Functional Requirements</h3><ul><li><strong>Scale:</strong> 10 TB data migration; handle 100s of millions of records.</li><li><strong>Availability:</strong> 99.9%; graceful handling of partial failures.</li><li><strong>Consistency:</strong> Idempotent writes; no duplicate records post-migration.</li><li><strong>Latency:</strong> Full migration completion &lt; 24 hours.</li><li><strong>Workload Profile:</strong><ul><li>Read:Write ratio: ~50:50</li><li>Throughput: 100‚Äì500 MB/sec</li><li>Retention: 7-day retention for reconciliation</li></ul></li></ul><h2 id=high-level-architecture>High-Level Architecture</h2><div class=mermaid>graph LR
Source --> Scanner
Scanner --> HashIndex[Hash Index]
Scanner --> Migrator
HashIndex --> Migrator
Migrator --> Target
Migrator -.->|checkpoint| StateDB[State DB]
Reconciler --> Source
Reconciler --> Target</div><p>A Scanner reads Source data chunks, consulting a Hash Index to filter out already-migrated records. A Migrator writes unique records to the Target system while checkpointing progress to a State DB. Concurrently, a Reconciler compares Source and Target blocks to ensure data integrity.</p><h2 id=data-design>Data Design</h2><p>A Hash Index combining a Bloom filter and a Key-Value map accelerates duplicate detection. A relational State Database tracks the exact status of each chunk (pending, syncing, verified) to guarantee idempotent resumption.</p><h3 id=hash-index-bloom-filter--kv-map>Hash Index (Bloom Filter + KV Map)</h3><table><thead><tr><th style=text-align:left>Store</th><th style=text-align:left>Purpose</th><th style=text-align:left>Key / Pattern</th><th style=text-align:left>Value</th></tr></thead><tbody><tr><td style=text-align:left><strong>Bloom</strong></td><td style=text-align:left>First-pass membership check.</td><td style=text-align:left><code>content_hash</code></td><td style=text-align:left>N/A (Probabilistic)</td></tr><tr><td style=text-align:left><strong>Map</strong></td><td style=text-align:left>Exact location lookup.</td><td style=text-align:left><code>h:&lt;sha256></code></td><td style=text-align:left><code>target_location_uri</code></td></tr></tbody></table><h3 id=migration-state-sql>Migration State (SQL)</h3><table><thead><tr><th style=text-align:left>Table</th><th style=text-align:left>Column</th><th style=text-align:left>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>checkpoints</strong></td><td style=text-align:left><code>chunk_id</code></td><td style=text-align:left>String (PK)</td><td style=text-align:left>Partition or PK-range identifier.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>status</code></td><td style=text-align:left>Enum</td><td style=text-align:left><code>pending</code>, <code>syncing</code>, <code>failed</code>, <code>verified</code>.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>checksum</code></td><td style=text-align:left>String</td><td style=text-align:left>Hash of migrating chunk for integrity.</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>run_id</code></td><td style=text-align:left>UUID</td><td style=text-align:left>To handle idempotent re-runs.</td></tr></tbody></table><h2 id=deep-dive--trade-offs>Deep Dive & Trade-offs</h2><h3 id=deep-dive>Deep Dive</h3><ul><li><p><strong>Chunking & Scanning:</strong> Dividing data into independent ranges enables parallel processing, bounded memory usage, and granular resumption.</p></li><li><p><strong>Content-hash Dedup:</strong> SHA-256 fingerprinting using a Bloom filter and persistent KV map detects and prevents redundant target writes.</p></li><li><p><strong>Idempotent Upserts:</strong> <code>INSERT ON CONFLICT UPDATE</code> semantics and <code>migration_run_id</code> tags ensure chunk re-runs converge to the correct state safely.</p></li><li><p><strong>Resumable Checkpoints:</strong> Persisting chunk statuses to a State DB allows the system to skip completed chunks on restart, enabling zero-waste recovery.</p></li><li><p><strong>Reconciliation:</strong> A parallel process compares checksums and counts, identifying divergent chunks for targeted re-migration.</p></li><li><p><strong>Rollback Strategy:</strong> Target snapshots or record-tagging enables atomic restoration if validation fails, protecting against corruption.</p></li><li><p><strong>Throttling:</strong> Adaptive throttling backs off dynamically based on source/target latency to protect live production performance.</p></li></ul><h3 id=trade-offs>Trade-offs</h3><ul><li><p><strong>Inline vs. Post-migration Dedup:</strong> Inline saves bandwidth/storage but adds latency; Post-migration simplifies the write path but generates temporary waste.</p></li><li><p><strong>Full vs. Sampled Reconciliation:</strong> Full guarantees bit-identical results but is expensive; Sampling is faster but can miss small-scale or localized data corruption.</p></li></ul><h2 id=operational-excellence>Operational Excellence</h2><h3 id=slis--slos>SLIs / SLOs</h3><ul><li>SLO: Complete 10 TB migration within 24 hours.</li><li>SLO: Post-migration reconciliation shows 0 mismatches (100% data integrity).</li><li>SLIs: migration_throughput_gbps, chunk_completion_rate, dedup_ratio, reconciliation_mismatch_count, checkpoint_lag.</li></ul><h3 id=reliability--resiliency>Reliability & Resiliency</h3><ul><li><strong>Dry-run</strong>: Run against staging target to validate dedup and transforms.</li><li><strong>Chaos</strong>: Kill workers mid-chunk and verify checkpoint-based resumption.</li><li><strong>Benchmark</strong>: Test hash index at billion-key scale for memory and latency.</li></ul></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/designs/background-job-queue/>Background Job Queue for Big Tasks</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Asynchronous job queue design for resource-heavy tasks (video encoding, data processing) with retries, idempotency, DLQ handling, and autoscaling.</small></li><li><a href=/systology/deep-dives/chowist/>Chowist</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Monolithic Django app for place listings; focus on production hardening: static serving, background jobs, connection pooling, and CI/CD.</small></li><li><a href=/systology/designs/web-crawler/>Distributed Web Crawler</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Design for a Google-scale web crawler focusing on Breadth-First Search (BFS), DNS resolution caching, robots.txt politeness, and handling duplicate or malicious domains.</small></li><li><a href=/systology/designs/cdn-media/>Global CDN Media Serving</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>CDN-backed media delivery architecture for low-latency, highly-available global media serving with background upload processing.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>