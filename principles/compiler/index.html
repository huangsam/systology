<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Compiler Design - Systology</title><meta name=description content="Optimization, portability and resilience for compilers."><link rel=canonical href=https://sambyte.net/systology/principles/compiler/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}document.documentElement.setAttribute("data-loading",""),requestAnimationFrame(function(){requestAnimationFrame(function(){document.documentElement.removeAttribute("data-loading")})})</script><style>html{background:#fff;color:#0f1724}html[data-theme=dark]{background:#0f1724;color:#e2e8f0}html[data-loading] *{transition:none!important}</style><link rel=stylesheet href=/systology/css/styles.css><link rel=stylesheet href=/systology/css/syntax.css><link rel=stylesheet href=/systology/css/search.css></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Compiler Design</h1></div><h2>Optimization, portability and resilience for compilers.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/compiler/>compiler</a></div></header><section><h2 id=clean-ir-boundaries>Clean IR Boundaries</h2><p>Maintain clear separation between parsing, semantic analysis, and IR lowering with explicit invariants between stages. This isolation makes each pass easier to test, understand, and optimize independently.</p><p>In practice, each compiler phase should consume a well-typed input and produce a well-typed output. The parser emits an AST, semantic analysis produces an annotated AST, and lowering generates an IR‚Äîeach boundary is a contract. When you need to change how optimization works, you modify one pass without worrying about ripple effects in parsing or code generation.</p><p><strong>Anti-pattern ‚Äî Monolithic Pass:</strong> Combining parsing, type-checking, and code generation into a single function. This makes bugs nearly impossible to isolate and kills incremental compilation potential. If adding a new language feature requires touching every stage simultaneously, your boundaries are too blurry.</p><h2 id=deterministic-semantics>Deterministic Semantics</h2><p>Define a well-specified language subset with predictable behavior rather than attempting to support every edge case‚Äîunsupported constructs should fail fast with clear error messages instead of producing subtle bugs downstream.</p><p>Write a specification (even an informal one) that answers: what happens for every input? Undefined behavior is the enemy of debuggability. If your language inherits UB from a host language (C, C++), document exactly which constructs are safe and add runtime checks in debug builds for the rest.</p><p><strong>Anti-pattern ‚Äî Implicit Coercion Soup:</strong> Allowing automatic type coercion everywhere (like JavaScript&rsquo;s <code>[] + {}</code>) to be &ldquo;flexible.&rdquo; This creates a combinatorial explosion of edge cases that surprises users and generates subtle bugs. Be explicit about conversions and require casts for lossy operations.</p><h2 id=error-reporting--ux>Error Reporting & UX</h2><p>Provide diagnostics linked to source locations with actionable recovery suggestions; error messages are the first impression users have of your compiler, so they should be designed for clarity over terseness.</p><p>Great error messages include:</p><ol><li>Where the error is (file, line, column with a source snippet)</li><li>What went wrong in plain language</li><li>How to fix it</li></ol><p>Rust&rsquo;s compiler errors are the gold standard‚Äîstudy them. Consider colorized output, ASCII art for pointer arrows, and &ldquo;did you mean?&rdquo; suggestions for typos.</p><p><strong>Anti-pattern ‚Äî Cryptic Error Codes:</strong> Emitting <code>"E0042: type mismatch"</code> with no context. If the user has to search a separate manual to understand an error, you&rsquo;ve failed at UX. Inline the explanation and show the relevant code snippet with the mismatch highlighted.</p><p><strong>Anti-pattern ‚Äî Error Avalanche:</strong> Reporting 200 errors when the first one (a missing semicolon) caused all subsequent ones. Implement error recovery in the parser so you can continue past the first error and report genuinely independent issues‚Äîbut cap the output and prioritize the first few.</p><h2 id=test-harnesses>Test Harnesses</h2><p>Use filecheck-style output testing (AST dumps, IR) and maintain regression suites across different architectures and optimization levels‚Äîthis catches silent correctness regressions that benchmarks miss.</p><p>Structure your test suite in tiers: (1) unit tests for individual passes, (2) snapshot tests that compare AST/IR dumps against golden files, (3) end-to-end tests that compile and run programs checking output, and (4) fuzz tests that generate random programs and verify the compiler doesn&rsquo;t crash.</p><p><strong>Anti-pattern ‚Äî Testing Only Happy Paths:</strong> Writing tests that only compile valid programs. Your compiler will spend most of its time handling invalid input‚Äîinvest heavily in tests for error paths, edge cases, and adversarial inputs.</p><h2 id=incremental-compilation>Incremental Compilation</h2><p>Cache artifacts and track dependencies to avoid recompiling unchanged modules, speeding up the feedback loop during development without sacrificing correctness through overly aggressive caching.</p><p>The key insight is dependency tracking: for each compilation unit, record what it depends on (imported symbols, macros, type definitions). When a dependency changes, invalidate only the affected units. Use content hashing (not timestamps) to detect actual changes‚Äîa file save that doesn&rsquo;t change content shouldn&rsquo;t trigger recompilation.</p><p><strong>Anti-pattern ‚Äî Cache Everything Forever:</strong> Aggressively caching without proper invalidation logic. Stale caches cause mysterious &ldquo;it works after a clean build&rdquo; bugs that destroy trust in the build system. When in doubt, invalidate more rather than less‚Äîcorrectness over speed.</p><h2 id=ir-validation>IR Validation</h2><p>Validate generated IR against reference implementations and include runtime assertions for critical invariants‚Äîthis catches code generation bugs early rather than letting them escape to production targets.</p><p>Build a verifier pass that runs after each transformation and checks structural invariants: types are consistent, control flow is well-formed, SSA dominance properties hold. This is cheap insurance‚Äîmost IR bugs manifest as violated invariants that a verifier catches instantly but would otherwise produce wrong code silently.</p><p><strong>Anti-pattern ‚Äî Trust the Transform:</strong> Assuming that if a transformation pass compiles, it produces correct IR. Compiler bugs are insidious because they produce programs that <em>almost</em> work. A verifier catches the subtle cases where a register is used before definition or a phi node references a non-dominating block.</p><p>See <a href=https://sambyte.net/systology/deep-dives/virtuc/>VirtuC</a> for an implementation of a compiler that emits LLVM IR and explicitly runs a verifier pass before backend compilation.</p><h2 id=tooling--teaching-aids>Tooling & Teaching Aids</h2><p>Provide AST and IR visualizers, interactive REPLs, and documentation with examples‚Äîthese tools help both compiler developers and users understand the pipeline and debug problems faster.</p><p>A <code>--dump-ast</code> flag, an IR pretty-printer, and a step-through mode that shows each optimization pass&rsquo;s effect on the IR are invaluable. For educational compilers, a web playground where users can type code and see the AST/IR live (√† la <a href=https://godbolt.org/>Compiler Explorer</a>) dramatically lowers the learning curve.</p><p>See the <a href=https://sambyte.net/systology/principles/extensibility/>Extensibility & Plugin Architecture</a> principles for related guidance on making compiler internals composable and inspectable.</p><h2 id=performance-vs-correctness>Performance vs. Correctness</h2><p>Prioritize correctness first, then add optimizations incrementally with benchmarks to validate improvements. Document performance-correctness tradeoffs and use assertions to guard invariants.</p><p>The ordering matters: a correct slow compiler can be optimized, but a fast incorrect compiler generates wrong programs that erode trust. Gate optimizations behind flags (<code>-O0</code>, <code>-O1</code>, <code>-O2</code>) so users can disable them when debugging, and ensure the unoptimized path is always available as a correctness baseline.</p><p><strong>Anti-pattern ‚Äî Optimization Without Tests:</strong> Adding an optimization pass (constant folding, dead code elimination, loop unrolling) without adding regression tests that exercise the corner cases. Every optimization is a potential source of miscompilation‚Äîtest the edge cases explicitly, not just the obvious wins.</p><h2 id=decision-framework>Decision Framework</h2><p>Choose your compiler architecture based on the target audience and longevity of the language:</p><table><thead><tr><th style=text-align:left>If you need&mldr;</th><th style=text-align:left>&mldr;choose this</th><th style=text-align:left>because&mldr;</th></tr></thead><tbody><tr><td style=text-align:left><strong>Instructional Clarity</strong></td><td style=text-align:left>Single-Pass/Tree-Walk</td><td style=text-align:left>Easiest for students to map source code to execution.</td></tr><tr><td style=text-align:left><strong>Production Speed</strong></td><td style=text-align:left>Multi-Pass with SSA</td><td style=text-align:left>Allows for complex optimizations like DCE and inlining.</td></tr><tr><td style=text-align:left><strong>Developer Velocity</strong></td><td style=text-align:left>Incremental Artifacts</td><td style=text-align:left>Minimizes recompile times for large codebases.</td></tr><tr><td style=text-align:left><strong>Reliable Portability</strong></td><td style=text-align:left>Stable C-API / LLVM</td><td style=text-align:left>Leverages existing backends for multiple CPU targets.</td></tr></tbody></table><p><strong>Decision Heuristic:</strong> &ldquo;Choose <strong>Clean IR Boundaries</strong> over performance hacks. A well-structured pipeline is easier to optimize later than a tangled monolithic pass is to fix.&rdquo;</p></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/deep-dives/virtuc/>VirtuC</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Rust-implemented compiler for a C subset that emits LLVM IR and focuses on AST design, semantic checks, and IR validation for teaching.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>