<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Media Analysis - Systology</title><meta name=description content="Feature extraction and real-time handling for media data."><link rel=canonical href=https://sambyte.net/systology/principles/media-analysis/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&document.documentElement.setAttribute("data-theme","dark")}catch{}document.documentElement.setAttribute("data-loading",""),document.addEventListener("DOMContentLoaded",function(){document.documentElement.removeAttribute("data-loading")})</script><style>html{background:#fff;color:#0f1724}html[data-theme=dark]{background:#0f1724;color:#e2e8f0}html[data-loading] *{transition:none!important}</style><link rel=stylesheet href=/systology/css/styles.css><link rel=stylesheet href=/systology/css/syntax.css><link rel=stylesheet href=/systology/css/search.css></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Media Analysis</h1></div><h2>Feature extraction and real-time handling for media data.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/feature-extraction/>feature-extraction</a>
<a class=badge href=/systology/tags/media/>media</a></div></header><section><h2 id=define-stable-output-schema>Define Stable Output Schema</h2><p>Design versioned JSON schemas for consistent downstream consumption with clear field semantics. Schema changes are costly downstream, so explicit versions and migrations matter more than backwards compatibility.</p><p>Include a <code>schema_version</code> field in every output document. When you need to add fields, bump the minor version and keep old fields intact. When you must remove or rename fields, bump the major version and provide a migration script. Downstream consumers can then filter on version and handle each schema explicitly rather than guessing what fields might exist.</p><p>See the <a href=https://sambyte.net/systology/designs/feature-etl/>Feature ETL</a> design for how schema evolution applies to ML feature pipelines at scale.</p><p><strong>Anti-pattern ‚Äî Schema-free JSON:</strong> Emitting unversioned JSON blobs where field names and types change between releases. Downstream consumers resort to defensive <code>try/except</code> blocks around every field access, and silent failures creep in when a field is renamed from <code>blur_score</code> to <code>blurriness</code>. Explicit schemas with versions eliminate this entire class of bug.</p><h2 id=cross-platform-vs-native>Cross-platform vs. Native</h2><p>Use cross-platform C++/OpenCV for portable batch pipelines but leverage native APIs (Metal, Vision) for optimized on-device work. Portability and performance pull in different directions.</p><p>The decision depends on your deployment target. If you&rsquo;re processing media in a cloud pipeline or a heterogeneous fleet, cross-platform OpenCV gives you one codebase everywhere. If you&rsquo;re running on Apple devices where latency matters, Metal and Vision framework deliver hardware-accelerated performance that OpenCV can&rsquo;t match.</p><p>See <a href=https://sambyte.net/systology/deep-dives/vidicant/>Vidicant</a> for a cross-platform C++ approach, and <a href=https://sambyte.net/systology/deep-dives/xcode-trial/>Xcode Trial</a> for leveraging Apple-native APIs (Metal, Vision, Core ML) for on-device media processing.</p><p><strong>Anti-pattern ‚Äî Lowest Common Denominator:</strong> Using only cross-platform APIs even when 95% of your users are on one platform. You sacrifice significant performance and capabilities to serve a theoretical audience. If your data shows most processing happens on macOS, use Metal for the fast path and provide a generic fallback.</p><h2 id=stream-vs-batch-processing>Stream vs. Batch Processing</h2><p>Implement streaming decode for long videos to avoid loading entire files into memory, and use batch processing with worker queues for archives. Support both modes with configurable buffers to avoid surprises.</p><p>For videos, streaming decode reads frames on demand using a decoder context (<code>cv::VideoCapture</code> in OpenCV, <code>AVAssetReader</code> in AVFoundation). This keeps memory constant regardless of video length. For batch processing of image archives, a worker pool processes files in parallel with a shared output sink.</p><p><strong>Anti-pattern ‚Äî Load-then-Process:</strong> Reading an entire 4K video file into memory before processing. A 1-hour 4K video at 60fps is ~1 TB of uncompressed frames‚Äîyour process OOMs before analysis begins. Always decode incrementally, processing frame-by-frame or in small batches.</p><p>See the <a href=https://sambyte.net/systology/designs/background-job-queue/>Background Job Queue</a> design for patterns on managing long-running media processing tasks with retries and progress tracking.</p><h2 id=metadata-preservation>Metadata Preservation</h2><p>Preserve EXIF data, timestamps, and codec information alongside analysis results and record processing parameters for reproducibility. Metadata enables audit trails and helps trace data provenance.</p><p>When your pipeline processes an image, carry forward the original&rsquo;s EXIF (camera model, GPS, timestamp), the processing parameters used (blur threshold, motion sensitivity, model version), and the output features. Store this as a sidecar JSON or embedded in the output format. This lets you answer &ldquo;why did the system flag this image?&rdquo; months later.</p><p><strong>Anti-pattern ‚Äî Metadata Stripping:</strong> Silently discarding EXIF and codec data during processing because &ldquo;we only need the pixels.&rdquo; When a downstream consumer needs to sort by capture date, geolocate images, or audit which camera produced artifacts, that metadata is irrecoverable. Preserve everything; let consumers decide what to discard.</p><p>See <a href=https://sambyte.net/systology/deep-dives/photohaul/>Photohaul</a> for an example of preserving EXIF metadata during large-scale photo migrations and deduplication. For related guidance on metadata fidelity, see the <a href=https://sambyte.net/systology/principles/migration-dedup/>Migration & Deduplication</a> principles.</p><h2 id=performance-engineering>Performance Engineering</h2><p>Profile decode, transform, and inference operations to find actual bottlenecks rather than guessing. Hardware acceleration (GPU, SIMD) and request batching multiply throughput but require measurement to pay off.</p><p>Use profilers specific to media workloads: <code>perf</code> with hardware counters for CPU-bound decode, GPU profilers (NSight, Metal System Trace) for GPU inference, and IO profilers for storage-bound workflows. Typical bottleneck progression: IO (reading files from disk/network) ‚Üí decode (decompressing frames) ‚Üí transform (resizing, color conversion) ‚Üí inference (ML model). Fix them in order.</p><p>See the <a href=https://sambyte.net/systology/principles/algorithms-performance/>Algorithms & Performance</a> principles for broader guidance on profiling and micro-benchmarking that applies directly to media pipelines.</p><p><strong>Anti-pattern ‚Äî GPU Cargo Cult:</strong> Moving everything to the GPU because &ldquo;GPUs are faster.&rdquo; Moving small images to GPU memory, running a trivial kernel, and copying back is slower than CPU processing due to transfer overhead. Profile the full pipeline including data transfer costs before committing to GPU acceleration.</p><h2 id=calibration--false-positives>Calibration & False Positives</h2><p>Provide tools for threshold tuning and include labeled test datasets for validation. False positives multiply costs downstream; invest in calibration to reduce them.</p><p>Ship a calibration CLI that takes a labeled dataset (images with known blur/motion/face ground truth) and sweeps threshold values, producing a precision-recall curve. Let users pick their operating point based on their cost of false positives vs. false negatives. Different use cases have wildly different tolerances‚Äîa security camera tolerates more false positives than a photo organizer.</p><p><strong>Anti-pattern ‚Äî One Threshold Fits All:</strong> Shipping a hardcoded threshold (e.g., blur score > 0.7 = blurry) without considering the variability of input data. A threshold calibrated on professional photos will flag every smartphone photo as blurry. Always expose thresholds as configurable parameters with documented calibration procedures.</p><h2 id=packaging--distribution>Packaging & Distribution</h2><p>Build wheels and native binaries for easy installation and provide CI/CD for cross-platform testing. Installation friction determines adoption; make it trivial.</p><p>For Python libraries with native components, build manylinux wheels (using <code>cibuildwheel</code>) and macOS universal2 wheels so users can <code>pip install</code> without compiling from source. For CLI tools, provide prebuilt binaries for major platforms via GitHub Releases or Homebrew. Test installation on bare VMs in CI to catch missing dependencies.</p><p>See <a href=https://sambyte.net/systology/deep-dives/vidicant/>Vidicant</a> for an example of managing cross-platform C++ packaging with Python bindings‚Äîwhere CI-built wheels and cmake instructions reduce installation friction.</p><p><strong>Anti-pattern ‚Äî &ldquo;Just Build From Source&rdquo;:</strong> Requiring users to install CMake, OpenCV, and platform-specific SDKs to try your library. 90% of potential users will give up at the first compilation error. Prebuilt packages aren&rsquo;t just convenient‚Äîthey&rsquo;re essential for adoption.</p><h2 id=privacy--on-device-processing>Privacy & On-device Processing</h2><p>Prefer on-device processing for sensitive media with clear documentation of what data leaves the device. Privacy violations are hard to repair; design for it upfront.</p><p>For applications that analyze personal photos or videos (face detection, location extraction, content moderation), process locally by default. If cloud processing is needed for heavier models, require explicit user opt-in with a clear explanation of what data is transmitted, how it&rsquo;s processed, and when it&rsquo;s deleted. Log all cloud transmissions for audit.</p><p>See the <a href=https://sambyte.net/systology/principles/privacy-agents/>Privacy & Agents</a> principles for comprehensive guidance on consent, data minimization, and audit logging that applies directly to media processing of personal data.</p><p><strong>Anti-pattern ‚Äî Silent Cloud Upload:</strong> Sending images to a cloud API for analysis without informing the user. Even if the API&rsquo;s privacy policy is fine, the user didn&rsquo;t consent to their photos leaving the device. Explicit opt-in isn&rsquo;t just good practice‚Äîit&rsquo;s increasingly a legal requirement (GDPR, CCPA).</p><h2 id=decision-framework>Decision Framework</h2><p>Choose your media analysis pattern based on the complexity of the media and the latency required for the analysis:</p><table><thead><tr><th style=text-align:left>If you need&mldr;</th><th style=text-align:left>&mldr;choose this</th><th style=text-align:left>because&mldr;</th></tr></thead><tbody><tr><td style=text-align:left><strong>Real-time Detection</strong></td><td style=text-align:left>Stream Processing</td><td style=text-align:left>Detects events (e.g., motion, faces) with sub-second latency.</td></tr><tr><td style=text-align:left><strong>High Accuracy</strong></td><td style=text-align:left>Batch Processing</td><td style=text-align:left>Allows for deeper, multi-pass model inference on high-res media.</td></tr><tr><td style=text-align:left><strong>Cost Efficiency</strong></td><td style=text-align:left>Edge Processing</td><td style=text-align:left>Reduces cloud egress by analyzing data on-device before uploading.</td></tr><tr><td style=text-align:left><strong>Searchability</strong></td><td style=text-align:left>Feature Extraction</td><td style=text-align:left>Converts heavy media into small, indexable vectors or tags.</td></tr></tbody></table><p><strong>Decision Heuristic:</strong> &ldquo;Choose <strong>Metadata Extraction</strong> before full media storage. It&rsquo;s cheaper to search a 1KB vector than to re-process a 10MB image every time.&rdquo;</p></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/designs/cdn-media/>Global CDN Media Serving</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>CDN-backed media delivery architecture for low-latency, highly-available global media serving with background upload processing.</small></li><li><a href=/systology/deep-dives/photohaul/>Photohaul</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Java tool for organizing and migrating large photo collections with deduplication, metadata preservation, and resumable jobs.</small></li><li><a href=/systology/deep-dives/vidicant/>Vidicant</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Cross-platform video/image feature extractor (C++ core, Python bindings) for ML preprocessing focusing on throughput, accuracy, and packaging.</small></li><li><a href=/systology/deep-dives/xcode-trial/>xcode-trial</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Multimodal video analysis on macOS using AVFoundation, Vision, and Core Image ‚Äî extracts faces, scenes, colors, motion, audio, and text with JSON output.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>