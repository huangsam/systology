<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Intervals & Constraints - Systology</title><meta name=description content="Heuristics for choosing windowing strategies based on SLA tensions."><link rel=canonical href=https://sambyte.net/systology/principles/interval-constraints/><link rel=icon href=/systology/favicon.svg type=image/svg+xml><meta name=robots content="index, follow"><script>try{localStorage.getItem("theme")==="dark"&&(document.documentElement.setAttribute("data-theme","dark"),document.documentElement.style.background="#0f1724")}catch{}</script><link rel=stylesheet href="/systology/css/styles.css?v=1772223161"><link rel=stylesheet href="/systology/css/syntax.css?v=1772223161"><link rel=stylesheet href="/systology/css/search.css?v=1772223161"></head><body><header class=site-header role=banner><div class="container header-inner"><a class=brand href=/systology/ aria-label=Systology><img src=/systology/favicon.svg alt class=logo-icon> Systology</a><nav class=site-nav role=navigation aria-label="Main navigation"><button class=search-toggle data-open-search aria-label=Search>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">
<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></nav></div></header><main id=content class="container prose"><article><header><div class=title-group><h1>Intervals & Constraints</h1></div><h2>Heuristics for choosing windowing strategies based on SLA tensions.</h2><div class=tags><span>Tags:</span>
<a class=badge href=/systology/tags/analytics/>analytics</a>
<a class=badge href=/systology/tags/data-pipelines/>data-pipelines</a>
<a class=badge href=/systology/tags/streaming/>streaming</a></div></header><section><h2 id=choosing-intervals-from-constraints>Choosing Intervals from Constraints</h2><p>In data engineering, &ldquo;Completeness&rdquo; (receiving all data) and &ldquo;Integrity&rdquo; (validating the data is clean/final) operate on different timescales. The choice of windowing strategy‚Äîhow you group and emit results‚Äîis a direct function of the gap between your <strong>Latency SLA</strong> (when the user must see data) and your <strong>Integrity Window</strong> (how long it takes for fraud, dedup, or late arrivals to settle).</p><p>When your Latency SLA is shorter than your Integrity Window, you are forced into <strong>Speculative Windowing</strong>. You must emit &ldquo;dirty&rdquo; results as soon as the window closes to satisfy the user, then emit &ldquo;corrections&rdquo; later as the data finalizes. Conversely, if your Latency SLA is generous, <strong>Pessimistic Windowing</strong> is preferred: hold the window in state until the integrity checks &ldquo;seal&rdquo; the interval, ensuring the first result emitted is also the final one.</p><ul><li>In Flink/Spark: use event-time watermarks and &ldquo;allowed lateness&rdquo; to control the speculation window; leverage <code>SideOutput</code> for events that arrive after the interval is &ldquo;sealed.&rdquo;</li><li>Cross-language: the concept of &ldquo;settlement&rdquo; is universal‚Äîdata in motion is a series of evolving estimates until a finality threshold is reached.</li></ul><p><strong>Anti-pattern ‚Äî Speculative Result Blindness</strong> ‚Äî Emitting early results without a mechanism to correct them later. This leads to &ldquo;Dashboard Drift,&rdquo; where real-time totals never match the final bill. If you speculate for speed, you must commit to the complexity of retractions.</p><h2 id=pessimistic-interval-sealing>Pessimistic Interval Sealing</h2><p>When Latency SLAs are generous enough to accommodate the full Integrity Window, <strong>Pessimistic Windowing</strong> provides a simpler and safer architecture. By holding the interval in the processor&rsquo;s state until it is &ldquo;sealed,&rdquo; you guarantee that every event emitted is final and correct. This eliminates the need for complex retraction logic or versioned merges in the sink.</p><p>The core challenge in pessimistic windowing is determining the <strong>Wait Threshold</strong>‚Äîthe specific point in time or signal that indicates the Integrity Window is closed and the data is safe to flush.</p><ul><li>In Flink/Spark: use a <code>WatermarkStrategy</code> with bounded out-of-orderness. The interval is only emitted when the watermark surpasses <code>window_end</code>.</li><li>In Batch: the interval is naturally sealed by the job boundaries; a daily job only runs once the previous day&rsquo;s source data is confirmed &ldquo;written&rdquo; and verified.</li></ul><p><strong>Anti-pattern ‚Äî The Indefinite Wait</strong> ‚Äî Setting a Wait Threshold that is too long or failing to implement a timeout for slow-running integrity sidecars. This causes memory pressure in the stream processor as state for &ldquo;unsealed&rdquo; windows accumulates indefinitely. You must balance &ldquo;absolute integrity&rdquo; with &ldquo;operational stability&rdquo; by setting a hard cutoff for finality.</p><h2 id=speculative-interval-merging>Speculative Interval Merging</h2><p>When operating in the speculative zone, the &ldquo;final&rdquo; result is not a single event but the <strong>Merge</strong> of an original estimate and one or more corrections. This requires a sink that is fundamentally commutative and idempotent. You must decide whether to overwrite previous estimates (Versioned Upsert) or adjust them (Retractions).</p><p>This pattern moves the complexity from the stream processor&rsquo;s memory to the storage layer&rsquo;s merge logic. It requires a robust &ldquo;Finality Threshold&rdquo;‚Äîa point in time where the system stops accepting corrections and locks the interval for audit or billing.</p><ul><li>In SQL/OLAP (ClickHouse, Druid): use <code>UPSERT</code> or <code>ReplacingMergeTree</code> with a version column (window_id + update_timestamp) to ensure the latest estimate wins.</li><li>In Event Streams (Kafka): use a &ldquo;Retraction Stream&rdquo; pattern where the processor emits a negative event (e.g., <code>count: -10</code>) to undo a previous estimate before emitting the updated count.</li></ul><p><strong>Anti-pattern ‚Äî Non-Idempotent Merge</strong> ‚Äî Sending speculative corrections to a sink that only supports blind appends (e.g., a simple log). This results in double-counting or orphaned estimates. Your choice of interval strategy is a primary constraint on your choice of sink.</p><h2 id=decision-framework>Decision Framework</h2><p>Choose your windowing strategy based on the tension between your Latency SLA and your integrity requirements:</p><table><thead><tr><th style=text-align:left>If you need&mldr;</th><th style=text-align:left>&mldr;choose this</th><th style=text-align:left>because&mldr;</th></tr></thead><tbody><tr><td style=text-align:left><strong>Real-time Speed</strong></td><td style=text-align:left>Speculative</td><td style=text-align:left>Users see updates immediately; corrects later.</td></tr><tr><td style=text-align:left><strong>Audit Accuracy</strong></td><td style=text-align:left>Pessimistic</td><td style=text-align:left>First result is the final result; no retractions.</td></tr><tr><td style=text-align:left><strong>System Simplicity</strong></td><td style=text-align:left>Pessimistic</td><td style=text-align:left>No need for complex merge or retraction logic.</td></tr><tr><td style=text-align:left><strong>Cost Efficiency</strong></td><td style=text-align:left>Batch Sealing</td><td style=text-align:left>Maximizes compression and minimizes ops overhead.</td></tr></tbody></table><p><strong>Decision Heuristic:</strong> &ldquo;Choose <strong>Speculative Windowing</strong> only when the cost of stale data (latency) is higher than the cost of correction (complexity).&rdquo;</p><h2 id=cross-principle-notes>Cross-principle Notes</h2><p>This principle extends the <strong>Time Semantics</strong> section in <a href=https://sambyte.net/systology/principles/data-pipelines/>Data Pipelines</a>. For a production example of speculative intervals in action, see the <strong>Deep Dive & Trade-offs</strong> in the <a href=https://sambyte.net/systology/designs/ad-click-aggregator/>Ad Click Aggregator</a>, where a 1-minute reporting SLA forces the system to handle fraud corrections as late-arriving retractions.</p></section><aside class=related><h3>Related</h3><ul><li><a href=/systology/designs/ad-click-aggregator/>Ad Click Aggregator</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Design for aggregating ad clicks at massive scale, focusing on deduplication, exactly-once processing, and low-latency reporting.</small></li><li><a href=/systology/deep-dives/beam-trial/>Beam Trial</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Minimal Apache Beam Hello World in Java/Gradle demonstrating pipeline construction, transforms, and DirectRunner execution for learning Beam's core model.</small></li><li><a href=/systology/principles/data-pipelines/>Data Pipelines</a>
<span class=related-type><small class=label-tag>tag</small>
<small class=label-cat>category</small></span><br><small class=muted>Principles for reliable batch and streaming pipelines: time semantics, fault tolerance, partitioning, observability, and reproducibility.</small></li><li><a href=/systology/designs/web-crawler/>Distributed Web Crawler</a>
<span class=related-type><small class=label-tag>tag</small></span><br><small class=muted>Design for a Google-scale web crawler focusing on Breadth-First Search (BFS), DNS resolution caching, robots.txt politeness, and handling duplicate or malicious domains.</small></li></ul></aside></article></main><footer class=site-footer role=contentinfo><div class="container footer-inner"><p class=copyright>&copy; 2026 Systology. All rights reserved.</p><div class=social-links><a href=https://github.com/huangsam target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=http://linkedin.com/in/sambyte target=_blank rel="noopener noreferrer" aria-label=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></footer><div id=site-search-modal class=site-search-modal-container style=display:none><div class=site-search-overlay data-close-search></div><div class=site-search-modal><div class=site-search-header><div class=site-search-input-wrapper><span class=site-search-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</span><input type=text class=site-search-input id=site-search-input placeholder="Search designs, principles, deep dives..." aria-label=Search autocomplete=off>
<button class=site-search-close data-close-search>&#215;</button></div></div><div class=site-search-body><div id=site-search-default class=site-search-default><div class=site-search-quick-links><a href=/systology/categories/ class=site-search-cta><span class=site-search-cta-icon>üìÇ</span>
<span class=site-search-cta-text>All Categories</span>
<span class=site-search-cta-arrow>‚Üí</span>
</a><a href=/systology/tags/ class=site-search-cta><span class=site-search-cta-icon>üè∑Ô∏è</span>
<span class=site-search-cta-text>All Tags</span>
<span class=site-search-cta-arrow>‚Üí</span></a></div></div><div id=site-search-results-list style=display:none></div></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){let i=null,o=null;const t=document.getElementById("site-search-modal"),n=document.getElementById("site-search-input"),s=document.getElementById("site-search-default"),e=document.getElementById("site-search-results-list"),d=document.querySelectorAll("[data-close-search]"),h=document.querySelectorAll("[data-open-search]");if(!t)return;document.body.appendChild(t);let l=!1;function u(){if(l)return;fetch("/systology/search-index.json").then(e=>e.json()).then(e=>{i=e.documents,l=!0}).catch(e=>console.error("Failed to load search index:",e))}function r(){u(),t.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{n.focus(),n.value.trim()?c(n.value):(s.style.display="block",e.style.display="none")},50)}function a(){t.style.display="none",document.body.style.overflow="",n.value="",e.innerHTML="",s.style.display="block",e.style.display="none"}h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),r()})}),d.forEach(e=>{e.addEventListener("click",a)});function c(t){if(!i)return;if(!t.trim()){s.style.display="block",e.style.display="none",e.innerHTML="";return}s.style.display="none",e.style.display="block",t=t.toLowerCase();const n=i.filter(e=>{const n=e.content.toLowerCase(),s=e.title.toLowerCase(),o=(e.tags||[]).join(" ").toLowerCase();return n.includes(t)||s.includes(t)}).slice(0,15);n.length===0?e.innerHTML='<p class="site-search-no-results">No results found.</p>':e.innerHTML=n.map(e=>`
        <a href="${e.url}" class="site-search-result">
          <div class="site-search-result-title">${e.title}</div>
          <div class="site-search-result-preview">${e.preview}</div>
          <div class="site-search-result-meta">
            <span class="site-search-badge-category">${e.category}</span>
            ${e.tags.map(e=>`<span class="site-search-badge">${e}</span>`).join("")}
          </div>
        </a>
      `).join("")}n.addEventListener("input",function(e){o&&clearTimeout(o),o=setTimeout(()=>{c(e.target.value)},300)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),t.style.display==="none"||t.style.display===""?r():a()),e.key==="Escape"&&t.style.display==="flex"&&a()})})</script><script>document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".pseudocode-toggle"),n=document.querySelectorAll(".pseudocode-modal-close"),s=document.querySelectorAll(".pseudocode-modal-overlay");function o(e){const t=document.getElementById(e);if(!t)return;t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const n=t.querySelector(".pseudocode-modal-close");n&&n.focus()}function e(e){if(!e)return;e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="";const t=document.querySelector(`.pseudocode-toggle[aria-controls="${e.id}"]`);t&&t.focus()}t.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("aria-controls");o(t)})}),n.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),s.forEach(t=>{t.addEventListener("click",t=>{const n=t.target.closest(".pseudocode-modal");e(n)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const t=document.querySelector(".pseudocode-modal.active");t&&e(t)}})})</script><script src=/systology/js/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){window.mermaid&&mermaid.initialize({startOnLoad:!0,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f3f4f6",primaryTextColor:"#0f1724",primaryBorderColor:"#2563eb",lineColor:"#6b7280",secondBkgColor:"#ffffff",tertiaryTextColor:"#6b7280",tertiaryColor:"#e6e9ee",noteBkgColor:"#f0f9ff",noteBorderColor:"#2563eb",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},flowchart:{useMaxWidth:!0,curve:"linear"},sequence:{useMaxWidth:!0},gantt:{useWidth:0[0]}});var e=document.getElementById("theme-toggle");e&&e.addEventListener("click",function(){var e=document.documentElement.getAttribute("data-theme")==="dark";document.documentElement.setAttribute("data-theme",e?"":"dark");try{localStorage.setItem("theme",e?"light":"dark")}catch{}})})</script></body></html>