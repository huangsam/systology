<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ if .Title }}{{ .Title }} - {{ end }}{{ .Site.Title }}</title>

  {{/* description: prefer page `description`, then `summary`, then page `Summary`, then site param */}}
  {{/* description precedence: page.description -> page.summary -> parent.summary/cascade -> .Summary ->
  site.description */}}
  {{ $desc := .Params.description | default .Params.summary | default (.Summary | plainify) | default
  .Site.Params.description }}
  {{ with $desc }}
  <meta name="description" content="{{ . }}">
  {{ end }}

  <link rel="canonical" href="{{ .Permalink }}" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="alternate icon" href="/favicon.ico" />
  <meta name="robots" content="index, follow" />

  <script>try { if (localStorage.getItem('theme') === 'dark') document.documentElement.setAttribute('data-theme', 'dark') } catch (e) { }</script>
  <link rel="stylesheet" href="/css/styles.css?v={{ now.Unix }}">
</head>

<body>
  {{ partial "header.html" . }}
  <main id="content" class="container prose">
    {{ block "main" . }}{{ end }}
  </main>
  {{ partial "footer.html" . }}

  <!-- Scroll-to-top button -->
  <button class="scroll-top" id="scroll-top" aria-label="Scroll to top">â†‘</button>

  <!-- Mermaid diagrams -->
  <script src="/js/mermaid.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      /* Mermaid */
      if (window.mermaid) {
        mermaid.initialize({
          startOnLoad: true,
          theme: 'base',
          securityLevel: 'loose',
          themeVariables: {
            primaryColor: '#f3f4f6',
            primaryTextColor: '#0f1724',
            primaryBorderColor: '#2563eb',
            lineColor: '#6b7280',
            secondBkgColor: '#ffffff',
            tertiaryTextColor: '#6b7280',
            tertiaryColor: '#e6e9ee',
            notebkgColor: '#f0f9ff',
            noteBorderColor: '#2563eb',
            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
          },
          flowchart: { useMaxWidth: true, curve: 'linear' },
          sequence: { useMaxWidth: true },
          gantt: { useWidth: undefined }
        });
      }

      /* Dark-mode toggle */
      var toggle = document.getElementById('theme-toggle');
      if (toggle) {
        toggle.addEventListener('click', function () {
          var dark = document.documentElement.getAttribute('data-theme') === 'dark';
          document.documentElement.setAttribute('data-theme', dark ? '' : 'dark');
          try { localStorage.setItem('theme', dark ? 'light' : 'dark'); } catch (e) { }
        });
      }

      /* Scroll-to-top */
      var btn = document.getElementById('scroll-top');
      if (btn) {
        window.addEventListener('scroll', function () {
          btn.classList.toggle('visible', window.scrollY > 400);
        }, { passive: true });
        btn.addEventListener('click', function () {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }
    });
  </script>
</body>

</html>
